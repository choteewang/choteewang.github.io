<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 正反馈系列: Webpack (二) · choteewang</title><meta name="description" content="正反馈系列: Webpack (二) - choteewang@qq.com"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="choteewang"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">CHOTEE'S BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">LIST</a></li><li class="nav-list-item"><a href="https://github.com/choteewang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">正反馈系列: Webpack (二)</h1><div class="post-info">2018年3月16日</div><div class="post-content"><p>上一篇博客总结了<code>webpack</code>的基本配置, 处理js, css, 代码分割, 懒加载, tree-shaking等方法, 这篇博客继续总结资源处理, 第三方js库处理, html相关, devServer相关等知识.</p>
<h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><h3 id="场景与技术"><a href="#场景与技术" class="headerlink" title="场景与技术"></a>场景与技术</h3><ul>
<li>CSS中引入的图片 <code>file-loader</code></li>
<li>自动合成的雪碧图 <code>postcss-sprites</code></li>
<li>压缩图片 <code>img-loader</code></li>
<li>Base64编码 <code>url-loader</code></li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">      use: ExtractTextWebpackPlugin.extract(</span><br><span class="line">        &#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                importLoaders: <span class="number">2</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                ident: <span class="string">'postcss'</span>,</span><br><span class="line">                plugins: [</span><br><span class="line">                  <span class="comment">// CSS 雪碧图</span></span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(&#123;</span><br><span class="line">                    spritePath: <span class="string">'dist/assets/imgs/sprites'</span>,</span><br><span class="line">                    <span class="comment">// 只对形如'border@2x.png'类似的文件名起效</span></span><br><span class="line">                    retina: <span class="literal">true</span></span><br><span class="line">                  &#125;),</span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)()</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.(png|jpg|jpeg|gif)$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// url-loader和file-loader在图片处理时唯一的区别是url-loader可以设limit转Base64</span></span><br><span class="line">          <span class="comment">// 所以可以用url-loader代替file-loader</span></span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            <span class="comment">// ext代表后缀名</span></span><br><span class="line">            name: <span class="string">'[name]-[hash:5].[ext]'</span>,</span><br><span class="line">            limit: <span class="number">1000</span>,</span><br><span class="line">            <span class="comment">// publicPath: 静态资源引用地址</span></span><br><span class="line">            <span class="comment">// 覆盖output中的publicPath设置</span></span><br><span class="line">            <span class="comment">// 若服务为httpServer, 设置为'/'则指向了网站根目录,相当于开启一个绝对路径</span></span><br><span class="line">            <span class="comment">/* 一些publicPath示例</span></span><br><span class="line"><span class="comment">            </span></span><br><span class="line"><span class="comment">                publicPath: "https://cdn.example.com/assets/", // CDN（总是 HTTPS 协议）</span></span><br><span class="line"><span class="comment">                publicPath: "//cdn.example.com/assets/", // CDN (协议相同)</span></span><br><span class="line"><span class="comment">                publicPath: "/assets/", // 相对于服务(server-relative)</span></span><br><span class="line"><span class="comment">                publicPath: "assets/", // 相对于 HTML 页面</span></span><br><span class="line"><span class="comment">                publicPath: "../assets/", // 相对于 HTML 页面</span></span><br><span class="line"><span class="comment">                publicPath: "", // 相对于 HTML 页面（目录相同）</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            publicPath: <span class="string">'/'</span>,</span><br><span class="line">            <span class="comment">// outputPath: 构建文件输出地址</span></span><br><span class="line">            <span class="comment">// 相对output.path的相对路径,以'/'结尾表示文件夹</span></span><br><span class="line">            outputPath: <span class="string">'assets/imgs/'</span>,</span><br><span class="line">            <span class="comment">// 会模拟源代码的目录结构生成对应的相对文件结构, 方便css等相对路径的引用</span></span><br><span class="line">            <span class="comment">// useRelativePath: true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'img-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            pngquant: &#123;</span><br><span class="line">              quality: <span class="number">80</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字体文件处理"><a href="#字体文件处理" class="headerlink" title="字体文件处理"></a>字体文件处理</h2><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><blockquote>
<p>方法同图片文件处理: 即不涉及Base64编码时使用<code>file-loader</code>,否则使用<code>url-loader</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(eot|woff2?|ttf|svg)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'url-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        name: <span class="string">'[name]-[hash:5].[ext]'</span>,</span><br><span class="line">        <span class="comment">// 转为 baseurl 的前提</span></span><br><span class="line">        limit: <span class="number">5000</span>,</span><br><span class="line">        publicPath: <span class="string">''</span>,</span><br><span class="line">        outputPath: <span class="string">'dist/'</span>,</span><br><span class="line">        useRelativePath: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="处理第三方JS库"><a href="#处理第三方JS库" class="headerlink" title="处理第三方JS库"></a>处理第三方JS库</h2><h3 id="场景和方法"><a href="#场景和方法" class="headerlink" title="场景和方法"></a>场景和方法</h3><ul>
<li>远程cdn库用script标签链html中: <code>script</code>标签在html页面中引入, <code>window</code>全局引入, 所有模块皆可使用</li>
<li>npm install的库注入模块中: <code>webpack.providePlugin</code>,  <code>imports-loader</code></li>
<li>本地目录下的js文件注入模块中: <code>resolve</code>属性配置<code>alias</code>后, <code>webpack.providePlugin</code>或<code>imports-loader</code>引入`</li>
</ul>
<h3 id="webpack-providePlugin"><a href="#webpack-providePlugin" class="headerlink" title="webpack.providePlugin"></a>webpack.providePlugin</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 若本地目录下的js文件需引入模块则配置resolve, npm仓库不需配置</span></span><br><span class="line">  <span class="comment">// 配置alias后也可用imports-loader导入</span></span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="comment">// jquery 别名，告诉webpack jquery = src/libs/jquery.min.js</span></span><br><span class="line">      <span class="comment">// 这里加$号的原因是需匹配具体文件,而不是文件夹</span></span><br><span class="line">      <span class="comment">// $号前的jquery字符串对应ProvidePlugin中的'jquery'</span></span><br><span class="line">      jquery$: path.resolve(__dirname, <span class="string">'src/libs/jquery.min.js'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 将jquery注入到每一个模块中</span></span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      $: <span class="string">'jquery'</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="imports-loader"><a href="#imports-loader" class="headerlink" title="imports-loader"></a>imports-loader</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: path.resolve(__dirname, <span class="string">'src/app.js'</span>),</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 使用 imports-loader 注入</span></span><br><span class="line">      loader: <span class="string">'imports-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        $: <span class="string">'jquery'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HTML-in-Webpack"><a href="#HTML-in-Webpack" class="headerlink" title="HTML in Webpack"></a>HTML in Webpack</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul>
<li>自动生成html, 引入bundle: <code>HtmlWebpackPlugin</code></li>
<li>html中img标签用src引入图片: <code>html-loader</code></li>
<li>直接在src中用require方式引用: <code>require</code>语法</li>
<li>将提取的manifest公共代码通过script标签引入, <code>htmlWebpackInlineChunkPlugin</code></li>
</ul>
<h3 id="自动生成html-htmlWebpackPlugin"><a href="#自动生成html-htmlWebpackPlugin" class="headerlink" title="自动生成html, htmlWebpackPlugin"></a>自动生成html, htmlWebpackPlugin</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    <span class="comment">// 可指定目录'dist/index.html'</span></span><br><span class="line">    filename: <span class="string">'index.html'</span>,</span><br><span class="line">    template: <span class="string">'./index.html'</span>,</span><br><span class="line">    minify: &#123;</span><br><span class="line">      collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 选择插入哪些entry生成的bundle</span></span><br><span class="line">    <span class="comment">// chunks: ['app','app2']</span></span><br><span class="line">    <span class="comment">// 选择是否插入生成的bundle</span></span><br><span class="line">    <span class="comment">// false时可以手动在html页面内引入</span></span><br><span class="line">    <span class="comment">// inject: true</span></span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="html中img标签用src引入图片-html-loader"><a href="#html中img标签用src引入图片-html-loader" class="headerlink" title="html中img标签用src引入图片, html-loader"></a>html中img标签用src引入图片, html-loader</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'html-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">          attrs: [<span class="string">'img:src'</span>, <span class="string">'img:data-src'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="直接在src中用require方式引用"><a href="#直接在src中用require方式引用" class="headerlink" title="直接在src中用require方式引用"></a>直接在src中用require方式引用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"$&#123;require('./assets/img.png')&#125;"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="将提取的manifest公共代码通过script标签引入-htmlWebpackInlineChunkPlugin"><a href="#将提取的manifest公共代码通过script标签引入-htmlWebpackInlineChunkPlugin" class="headerlink" title="将提取的manifest公共代码通过script标签引入, htmlWebpackInlineChunkPlugin"></a>将提取的manifest公共代码通过script标签引入, htmlWebpackInlineChunkPlugin</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">'manifest'</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="keyword">new</span> HtmlInlinkChunkPlugin(&#123;</span><br><span class="line">  <span class="comment">// 注意若在htmlWebpackPlugin中配置了chunks属性, 需将'manifest'加入数组</span></span><br><span class="line">  inlineChunks: [<span class="string">'manifest'</span>]</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<h2 id="开发服务器"><a href="#开发服务器" class="headerlink" title="开发服务器"></a>开发服务器</h2><h3 id="三种方式"><a href="#三种方式" class="headerlink" title="三种方式"></a>三种方式</h3><p><code>webpack-watch-mode</code>, 只监视文件,无服务器<br><code>webpack-dev-server</code><br><code>express + webpack-dev-middleware</code> 灵活的配置服务, 比如<code>koa</code>替换<code>express</code></p>
<h3 id="清除webpack代码-cleanWebpackPlugin"><a href="#清除webpack代码-cleanWebpackPlugin" class="headerlink" title="清除webpack代码, cleanWebpackPlugin"></a>清除webpack代码, cleanWebpackPlugin</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// 数组中是需要清除的路径</span></span><br><span class="line"><span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>])</span><br></pre></td></tr></table></figure>
<h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h3><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ul>
<li>live-reloading</li>
<li>打包文件写入内存</li>
<li>路径重定向</li>
<li>https</li>
<li>浏览器中显示编译错误</li>
<li>接口代理</li>
<li>模块热更新</li>
</ul>
<h4 id="npm-scripts-启动"><a href="#npm-scripts-启动" class="headerlink" title="npm scripts 启动"></a>npm scripts 启动</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line">"scripts": &#123;</span><br><span class="line">  // 通过命令行形式直接运行webpack-dev-server会找不到</span><br><span class="line">  // 因为该命令入口在/node_modules/.bin目录下</span><br><span class="line">  "server": "webpack-dev-server --open"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="H5-history-api-rewrite-historyApiFallback"><a href="#H5-history-api-rewrite-historyApiFallback" class="headerlink" title="H5 history api rewrite, historyApiFallback"></a>H5 history api rewrite, historyApiFallback</h4><blockquote>
<p>作用: 当使用 <code>HTML5 History AP</code>I 时，任意的 404 响应都可能需要被替代为 index.html<br>也可以配置rewrites进一步配置, 防止用户在浏览器栏输入地址并刷新时跳转到不存在的404页面</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 头部不用import devServer</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">  <span class="comment">// liveReloading是自动的, 不用参数配置</span></span><br><span class="line">  <span class="comment">// 本地服务端口号</span></span><br><span class="line">  port: <span class="number">9001</span>,</span><br><span class="line">  <span class="comment">// HTML5 histroy API rewrite</span></span><br><span class="line">  <span class="comment">// 简单版使用 'historyApiFallback: true'</span></span><br><span class="line">  <span class="comment">// 之后在浏览器访问一个不存在的地址时不会报404,会停留在index.html</span></span><br><span class="line">  <span class="comment">// historyApiFallback: true</span></span><br><span class="line">  historyApiFallback: &#123;</span><br><span class="line">    rewrites: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 来自什么样的路径</span></span><br><span class="line">        <span class="keyword">from</span>: <span class="regexp">/^\/([a-zA-Z0-9]+\/?)([a-zA-Z0-9]+)/</span>,</span><br><span class="line">        <span class="comment">// 跳转到哪里</span></span><br><span class="line">        <span class="comment">// context拿到正则捕获组</span></span><br><span class="line">        to: <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">'/'</span> + context.match[<span class="number">1</span>] + context.match[<span class="number">2</span>] + <span class="string">'.html'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><blockquote>
<p>Proxy 内部集成 <code>http-proxy-middleware</code></p>
</blockquote>
<ul>
<li><code>target</code>: 指定代理服务器地址</li>
<li><code>changeOrigin</code>: 改变源到url, 设置为true时可以请求vitual host站点, 默认false记得设为true</li>
<li><code>headers</code>: 给http增加请求头</li>
<li><code>logLevel</code>: 在控制台或terminal中显示代理信息, 帮助调试</li>
<li><code>pathRewrite</code>: 可以用简短的地址代替长地址请求</li>
</ul>
<blockquote>
<p>例: 请求新浪微博接口 <code>https://m.weibo.cn/api/comments/show?id=4193586758833502&amp;page=1</code><br>在js文件中用jquery请求我们自己定义的短路径’/comments/show’</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在自己开发的js中写入下述代码</span></span><br><span class="line"><span class="comment">// '/comments/show' 是我们自己定义的缩短路径</span></span><br><span class="line">$.get(<span class="string">'/comments/show'</span>, &#123;</span><br><span class="line">  id: <span class="string">'4193586758833502'</span>,</span><br><span class="line">  page: <span class="number">1</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">  port: <span class="number">9001</span>,</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    <span class="comment">// 需要被代理的路径开头</span></span><br><span class="line">    <span class="string">'/'</span>: &#123;</span><br><span class="line">      <span class="comment">// 指定代理服务器地址</span></span><br><span class="line">      target: <span class="string">'https://m.weibo.cn'</span>,</span><br><span class="line">      <span class="comment">// 设置为true时可以请求vitual host站点, 默认false, 需要设置为true</span></span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 在控制台或terminal中显示代理信息, 帮助调试</span></span><br><span class="line">      logLevel: <span class="string">'debug'</span>,</span><br><span class="line">      <span class="comment">// 用简短的地址替换长地址请求</span></span><br><span class="line">      pathRewrite: &#123;</span><br><span class="line">        <span class="string">'^/comments'</span>: <span class="string">'/api/comments'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 给http协议增加请求头</span></span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Cookie'</span>: <span class="string">'_T_WM=044532f80b8fabc6dc347fd417c33202; ALF=1517569014; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhQljxrwvAfCCZa_p.u8pB.5JpX5K-hUgL.Fo2cS0qRehBcSKM2dJLoI7HpqJ8XwBtt; SCF=AkQsXaaTywl0RziwnumQ0tVE_xW5udcpoGP43q7eb2tFW9lXRc4bVNOn9N5m_ZKwFc-Q2r4Hz5oMBAbVJuhI1uk.; SUB=_2A253SLARDeRhGedI7FQZ8CrKzjuIHXVUstBZrDV6PUJbktANLUXEkW1NVtAHXD7nHQtwFntsDZsmqj2nB17cClnd; SUHB=0k1zt1ckxYq3c6; H5_INDEX_TITLE=qbaty; H5_INDEX=0_all; WEIBOCN_FROM=1110006030; M_WEIBOCN_PARAMS=oid%3D4193586758833502%26luicode%3D20000061%26lfid%3D4193594443440569%26uicode%3D20000061%26fid%3D4193586758833502'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="模块热更新-MHR-Module-Hot-Reloading"><a href="#模块热更新-MHR-Module-Hot-Reloading" class="headerlink" title="模块热更新 MHR(Module Hot Reloading)"></a>模块热更新 MHR(Module Hot Reloading)</h4><blockquote>
<p>与liveReloading的区别: </p>
</blockquote>
<ul>
<li>不重新刷新浏览器更新前端代码</li>
<li>可以保持应用数据状态</li>
<li>节省时间, 样式调试更快</li>
</ul>
<blockquote>
<p>所需工具和方法</p>
</blockquote>
<ul>
<li><code>devServer.hot: true</code> 即可使用</li>
<li><code>webpack.HotModuleReplacementPlugin</code> 必须使用</li>
<li><code>webpack.NamedModulesPlugin</code> 启用HMR时, 如果想看到模块相对路径, 需使用</li>
</ul>
<blockquote>
<p>配置</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 使全局无论如何不通过刷新页面实现热更新</span></span><br><span class="line">  hotOnly: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">  <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: HMR更新的是内存中的代码, 所以若css用<code>ExtractTextWebpackPlugin</code>提取过的话, 无法进行热更新<br>解决方法是改为<code>style-loader</code>注入的方式<br>关于<code>NamedModulesPlugin</code>的具体效果, 移步<a href="https://doc.webpack-china.org/guides/caching/#%E6%A8%A1%E5%9D%97%E6%A0%87%E8%AF%86%E7%AC%A6-module-identifiers-" target="_blank" rel="noopener">webpack官中文档</a></p>
</blockquote>
<h2 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h2><h3 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h3><blockquote>
<p>JS Source Map</p>
</blockquote>
<ul>
<li><code>devtool</code></li>
<li><code>webpack.SourceMapDevToolPlugin</code></li>
<li><code>webpack.EvalSourceMapDevToolPlugin</code></li>
</ul>
<blockquote>
<p>CSS Source Map<br>将下列属性设置为true即可</p>
</blockquote>
<ul>
<li><code>style-loader.option.sourceMap</code></li>
<li><code>css-loader.option.sourceMap</code> </li>
<li><code>less-loader.option.sourceMap</code></li>
<li><code>sass-loader.option.sourceMap</code></li>
</ul>
<h3 id="devtool-取值"><a href="#devtool-取值" class="headerlink" title="devtool 取值"></a>devtool 取值</h3><blockquote>
<p>Development</p>
</blockquote>
<ul>
<li><code>eval</code></li>
<li><code>eval-source-map</code></li>
<li><code>cheap-eval-source-map</code></li>
<li><code>cheap-module-eval-source-map</code> 建议在开发环境使用</li>
</ul>
<blockquote>
<p>Production</p>
</blockquote>
<ul>
<li><code>source-map</code></li>
<li><code>hidden-source-map</code></li>
<li><code>nosource-source-map</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CSS-Source-Map-设置"><a href="#CSS-Source-Map-设置" class="headerlink" title="CSS Source Map 设置"></a>CSS Source Map 设置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'style-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        <span class="comment">// 必须去掉singleton属性才可以正确开启css-sourcemap</span></span><br><span class="line">        <span class="comment">// singleton: true</span></span><br><span class="line">        sourceMap: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'css-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        importLoaders: <span class="number">2</span>,</span><br><span class="line">        sourceMap: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        ident: <span class="string">'postcss'</span>,</span><br><span class="line">        sourceMap: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'less-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        sourceMap: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="设置-EsLint"><a href="#设置-EsLint" class="headerlink" title="设置 EsLint"></a>设置 EsLint</h2><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><ul>
<li><code>eslint</code></li>
<li><code>eslint-loader</code></li>
<li><code>eslint-plugin-html</code>: 当在html中以script标签引入js时开启eslint</li>
<li><code>eslint-friendly-formatter</code> 开启更友好的eslint提示</li>
</ul>
<h3 id="方式-1"><a href="#方式-1" class="headerlink" title="方式"></a>方式</h3><ul>
<li>在<code>webpack.config.js</code>中开启<code>eslint-loader</code></li>
<li>在<code>.eslintrc</code>或<code>package.json</code>中的<code>eslintConfig</code>属性中设置相关选项</li>
</ul>
<h3 id="eslint规范"><a href="#eslint规范" class="headerlink" title="eslint规范"></a>eslint规范</h3><blockquote>
<p>JavaScript Standard Style (<a href="https://standardjs.com/" target="_blank" rel="noopener">https://standardjs.com/</a>)</p>
</blockquote>
<ul>
<li><code>eslint-config-standard</code></li>
<li><code>eslint-plugin-promise</code></li>
<li><code>eslint-plugin-standard</code></li>
<li><code>eslint-plugin-import</code></li>
<li><code>eslint-plugin-node</code></li>
<li><code>eslint-config-xxx</code></li>
</ul>
<h3 id="eslint-loader等配置"><a href="#eslint-loader等配置" class="headerlink" title="eslint-loader等配置"></a>eslint-loader等配置</h3><blockquote>
<p>eslint-loader</p>
</blockquote>
<ul>
<li><code>options.failOnWarning</code>: 若Warning则不通过编译</li>
<li><code>options.failOnError</code>: 若Error则不通过编译</li>
<li><code>options.formatter</code>: 设置第三方友好代码提示的选项, 可用<code>eslint-friendly-formatter</code></li>
<li><code>options.outputReport</code>: 输出一个代码格式检查的报告</li>
</ul>
<blockquote>
<p><code>devServer.overlay</code><br>配置此选项可让eslint在浏览器中输出</p>
</blockquote>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint eslint-loader eslint-plugin-html eslint-friendly-formatter --save-dev</span><br><span class="line">npm install eslint-config-standard eslint-plugin-promise eslint-plugin-node eslint-plugin-import eslint-plugin-standard --save-dev</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">  overlay: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      include: [path.resolve(__dirname, <span class="string">'src'</span>)],</span><br><span class="line">      exclude: [path.resolve(__dirname, <span class="string">'src/libs'</span>)],</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'env'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'eslint-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            <span class="comment">// 设置第三方友好代码提示的选项, 可用`eslint-friendly-formatter`</span></span><br><span class="line">            formatter: <span class="built_in">require</span>(<span class="string">'eslint-friendly-formatter'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  extends: <span class="string">'standard'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// eslint-plugin-html插件</span></span><br><span class="line">    <span class="string">'html'</span></span><br><span class="line">  ],</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 允许的全局变量</span></span><br><span class="line">  globals: &#123;</span><br><span class="line">    $: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 覆盖extends标准的规则</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">'indent'</span>: [<span class="string">'error'</span>, <span class="number">4</span>],</span><br><span class="line">    <span class="string">'eol-last'</span>: [<span class="string">'error'</span>, <span class="string">'never'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Resolve"><a href="#Resolve" class="headerlink" title="Resolve"></a>Resolve</h2><h3 id="resolve-alias"><a href="#resolve-alias" class="headerlink" title="resolve.alias"></a>resolve.alias</h3><blockquote>
<p>可以在<code>import</code>时启用别名替换</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">alias: &#123;</span><br><span class="line">  Utilities: path.resolve(__dirname, <span class="string">'src/utilities/'</span>),</span><br><span class="line">  Templates: path.resolve(__dirname, <span class="string">'src/templates/'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置前: import Utility from '../../utilities/utility';</span></span><br><span class="line"><span class="comment">// 设置后: import Utility from 'Utilities/utility';</span></span><br></pre></td></tr></table></figure>
<h3 id="resolve-extensions"><a href="#resolve-extensions" class="headerlink" title="resolve.extensions"></a>resolve.extensions</h3><blockquote>
<p>可以在<code>import</code>时忽略的扩展名</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">resolve: &#123;</span><br><span class="line">  extensions: [<span class="string">".js"</span>, <span class="string">".vue"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="区分开发环境和生产环境"><a href="#区分开发环境和生产环境" class="headerlink" title="区分开发环境和生产环境"></a>区分开发环境和生产环境</h2><blockquote>
<p>开发环境需要(对应<code>webpack.dev.conf.js</code>):</p>
</blockquote>
<ul>
<li>模块热更新</li>
<li>sourceMap</li>
<li>接口代理</li>
<li>代码规范检查</li>
</ul>
<blockquote>
<p>生产环境需要(对应<code>webpack.prod.conf.js</code>): </p>
</blockquote>
<ul>
<li>提取公用代码</li>
<li>压缩混淆</li>
<li>文件压缩或Base64编码</li>
<li>Tree-Shaking</li>
</ul>
<blockquote>
<p>共同点(对应<code>webpack.common.conf.js</code>)</p>
</blockquote>
<ul>
<li>同样的入口</li>
<li>同样的代码处理(loader处理)</li>
<li>同样的解析配置</li>
</ul>
<h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h3><ul>
<li>用<code>webpack.DefinePlugin</code>设置常量</li>
<li>进阶: <code>webpack-merge</code> 拼接webpack配置</li>
</ul>
<h3 id="webpack-DefinePlugin"><a href="#webpack-DefinePlugin" class="headerlink" title="webpack.DefinePlugin"></a>webpack.DefinePlugin</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: env === PRODUCTION ? ExtractTextPlugin.extract(&#123;</span><br><span class="line">          use: <span class="string">'css-loader'</span>,</span><br><span class="line">          fallback: <span class="string">'style-loader'</span></span><br><span class="line">        &#125;) : <span class="string">'style-loader!css-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 此插件用来定义全局变量</span></span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="comment">// 因为插件直接进行文本替换,要保留原始引号,两种方法是:</span></span><br><span class="line">      <span class="comment">// 1. '"production"'</span></span><br><span class="line">      <span class="comment">// 2. JSON.stringify('production')</span></span><br><span class="line">      PRODUCTION: <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>),</span><br><span class="line">      DEV: <span class="built_in">JSON</span>.stringify(<span class="string">'development'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="webpack-merge配置"><a href="#webpack-merge配置" class="headerlink" title="webpack-merge配置"></a>webpack-merge配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line">"scripts": &#123;</span><br><span class="line">  "server": "webpack-dev-server --env development --open --config build/webpack.common.conf.js",</span><br><span class="line">  "build": "webpack --env production --config build/webpack.common.conf.js",</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.conf.js</span></span><br><span class="line"><span class="keyword">const</span> productionConfig = <span class="built_in">require</span>(<span class="string">'./webpack.prod.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> developmentConfig = <span class="built_in">require</span>(<span class="string">'./webpack.dev.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="comment">// 生成提取css文件的Plugin</span></span><br><span class="line"><span class="keyword">const</span> extractLess = <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">  filename: <span class="string">'css/[name]-bundle-[hash:5].css'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 这里的参数env是npm scripts --env 传入的字符串</span></span><br><span class="line"><span class="keyword">const</span> generateConfig = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置js需要的scriptloader</span></span><br><span class="line">  <span class="keyword">const</span> scriptLoader = [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'babel-loader'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ].concat(env === <span class="string">'production'</span> ? [] : [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'eslint-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        formatter: <span class="built_in">require</span>(<span class="string">'eslint-friendly-formatter'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置css需要的cssLoaders</span></span><br><span class="line">  <span class="keyword">const</span> cssLoaders = [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'css-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        importLoaders: <span class="number">2</span>,</span><br><span class="line">        <span class="comment">// 若是dev环境则关闭sourceMap</span></span><br><span class="line">        sourceMap: env === <span class="string">'development'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        ident: <span class="string">'postcss'</span>,</span><br><span class="line">        <span class="comment">// 若是dev环境则关闭sourceMap</span></span><br><span class="line">        sourceMap: env === <span class="string">'development'</span>,</span><br><span class="line">        plugins: [</span><br><span class="line">          <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)()</span><br><span class="line">        ].concat(</span><br><span class="line">          <span class="comment">// 若是生产环境,加载post-css雪碧图功能</span></span><br><span class="line">          env === <span class="string">'production'</span></span><br><span class="line">            ? <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(&#123;</span><br><span class="line">              spritePath: <span class="string">'dist/assets/imgs/sprites'</span>,</span><br><span class="line">              retina: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">            : []</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'less-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        <span class="comment">// 若是dev环境则关闭sourceMap</span></span><br><span class="line">        sourceMap: env === <span class="string">'development'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// style-loader若是prod环境需提取,dev环境直接使用style-loader</span></span><br><span class="line">  <span class="keyword">const</span> styleLoader = env === <span class="string">'production'</span></span><br><span class="line">    ? extractLess.extract(&#123;</span><br><span class="line">      fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">      use: cssLoaders</span><br><span class="line">    &#125;)</span><br><span class="line">    : [&#123;</span><br><span class="line">      loader: <span class="string">'style-loader'</span></span><br><span class="line">    &#125;].concat(cssLoaders)</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 针对file-loader的配置</span></span><br><span class="line">  <span class="comment">// fileLoader根据img和font文件的不同设置不同的outputPath</span></span><br><span class="line">  <span class="keyword">const</span> fileLoader = <span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果是dev环境,使用file-loader,若是prod环境,使用url-loader开启Base64编码</span></span><br><span class="line">    <span class="keyword">return</span> env === <span class="string">'development'</span></span><br><span class="line">      ? [&#123;</span><br><span class="line">        loader: <span class="string">'file-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          name: <span class="string">'[name]-[hash:5].[ext]'</span>,</span><br><span class="line">          outputPath: path</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">      : [&#123;</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          name: <span class="string">'[name]-[hash:5].[ext]'</span>,</span><br><span class="line">          limit: <span class="number">1000</span>,</span><br><span class="line">          outputPath: path</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        loader: <span class="string">'img-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          pngquant: &#123;</span><br><span class="line">            quality: <span class="number">80</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回配置对象, 在各自rules的use字段载入上述定义的loader</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    entry,</span><br><span class="line">    output,</span><br><span class="line">    resolve,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">          include: [path.resolve(__dirname, <span class="string">'../src'</span>)],</span><br><span class="line">          exclude: [path.resolve(__dirname, <span class="string">'../src/libs'</span>)],</span><br><span class="line">          use: scriptLoader</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">          use: styleLoader(<span class="string">'assets/imgs/'</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(png|jpg|jpeg|gif)$/</span>,</span><br><span class="line">          use: fileLoader</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.(eot|woff2?|ttf|svg)$/</span>,</span><br><span class="line">          use: fileLoader(<span class="string">'assets/fonts/'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="comment">// 提取less</span></span><br><span class="line">      extractLess,</span><br><span class="line">      <span class="comment">// 自动生成html, 引入bundle</span></span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'index.html'</span>,</span><br><span class="line">        template: <span class="string">'./index.html'</span>,</span><br><span class="line">        minify: &#123;</span><br><span class="line">          collapseWhitespace: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 将本地的jquery文件注入到每一个模块中</span></span><br><span class="line">      <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">        $: <span class="string">'jquery'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的参数env是npm scripts --env 传入的字符串</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// config根据传入的env变量赋值为对应的prod配置或dev配置</span></span><br><span class="line">  <span class="keyword">let</span> config = env === <span class="string">'production'</span></span><br><span class="line">    ? productionConfig</span><br><span class="line">    : developmentConfig</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> merge(generateConfig(env), config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.conf.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">  devServer,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 引入devServer相关plugins</span></span><br><span class="line">    <span class="comment">// 热更新</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="comment">// 启用热更新时显示模块相对路径</span></span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.conf.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// CSS Tree Shaking</span></span><br><span class="line">    <span class="keyword">new</span> PurifyWebpack(&#123;</span><br><span class="line">      paths: glob.sync([</span><br><span class="line">        <span class="string">'./*.html'</span>,</span><br><span class="line">        <span class="string">'./src/*.js'</span></span><br><span class="line">      ])</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取manifest</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'manifest'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 将manifest以script标签形式放入html中</span></span><br><span class="line">    <span class="keyword">new</span> HtmlInlinkChunkPlugin(&#123;</span><br><span class="line">      inlineChunks: [<span class="string">'manifest'</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// JS Tree Shaking</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(),</span><br><span class="line">    <span class="comment">// 打包前 clean dist 目录</span></span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(path.resolve(__dirname, <span class="string">'../dist'</span>)),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="优化打包速度"><a href="#优化打包速度" class="headerlink" title="优化打包速度"></a>优化打包速度</h2><blockquote>
<p>分开vender和app</p>
</blockquote>
<ul>
<li><code>DllPlugin</code>: 通过打包第三包库会生成map(映射关系),供业务代码引用</li>
<li><code>DllReferencePlugin</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dll.conf.js</span></span><br><span class="line"><span class="comment">// 所有vendor库代码打包配置</span></span><br><span class="line"><span class="comment">// 在生产环境构建中运行一次即可 webpack --config webpack.dll.conf.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vue: [<span class="string">'vue'</span>, <span class="string">'vue-router'</span>],</span><br><span class="line">    ui: [<span class="string">'element-ui'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, <span class="string">'../src/dll/'</span>),</span><br><span class="line">    filename: <span class="string">'[name].dll.js'</span>,</span><br><span class="line">    <span class="comment">// 定义第三方库的引用名, 若不配置此项, 则vendor都以全局变量引入</span></span><br><span class="line">    library: <span class="string">'[name]'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// `DllPlugin`: 通过打包第三包库会生成map(映射关系),供业务代码引用</span></span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      <span class="comment">// 这里选择的输出其实是map的输出地址, map是json文件</span></span><br><span class="line">      path: path.join(__dirname, <span class="string">'../src/dll/'</span>, <span class="string">'[name]-manifest.json'</span>),</span><br><span class="line">      name: <span class="string">'[name]'</span></span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2018/03/16/5aab232642fad.jpg" alt=""></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.conf.js</span></span><br><span class="line">plugins: [</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// 用DllReferencePlugin将刚才生成的map文件引入</span></span><br><span class="line">  <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">    manifest: <span class="built_in">require</span>(<span class="string">'../src/dll/ui-manifest.json'</span>)</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">    manifest: <span class="built_in">require</span>(<span class="string">'../src/dll/vue-manifest.json'</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>平行处理压缩混淆</p>
</blockquote>
<ul>
<li><code>UglifyJsPlugin</code><ul>
<li><code>parallel: true</code>: 平行线程处理</li>
<li><code>cache: true</code>: 利用缓存</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.conf.js</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">    parallel: <span class="literal">true</span>,</span><br><span class="line">    cache: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>平行处理文件loaders处理</p>
</blockquote>
<ul>
<li><code>HappyPack</code><ul>
<li><code>HappyPack.ThreadPool</code>: 共享文件loaders处理线程池</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.conf.js</span></span><br><span class="line"><span class="keyword">const</span> HappyPack = <span class="built_in">require</span>(<span class="string">'happypack'</span>)</span><br><span class="line"><span class="keyword">const</span> vueLoaderConfig = <span class="built_in">require</span>(<span class="string">'./vue-loader.conf'</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">      <span class="comment">// id与plugins中HappyPack实例中的id相对应, </span></span><br><span class="line">      <span class="comment">// 将options传给plugins中的happyPack实例即可, 不用在此引入</span></span><br><span class="line">      loader: <span class="string">'happypack/loader?id=vue'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">    id: <span class="string">'vue'</span>,</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      loader: <span class="string">'vue-loader'</span>,</span><br><span class="line">      option: <span class="built_in">require</span>(<span class="string">'./vue-loader.conf'</span>)</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>babel-loader</p>
</blockquote>
<ul>
<li><code>options.cacheDirecotry</code>: 开启缓存</li>
<li><code>include</code> &amp; <code>exclude</code>: 尽可能规定使用babel范围</li>
</ul>
<blockquote>
<p>其他因素</p>
</blockquote>
<ul>
<li>减少<code>resolve</code></li>
<li>上线去除<code>sourcemap</code></li>
<li><code>cache-loader</code>: 将所有loader结果缓存</li>
<li>升级<code>node</code>与<code>webpack</code></li>
</ul>
<h2 id="长缓存优化"><a href="#长缓存优化" class="headerlink" title="长缓存优化"></a>长缓存优化</h2><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>当版本更新时, 使用户的浏览器只下载更新过的模块, 其他模块由于hash值的不变不用用户再次下载</p>
<h3 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h3><ul>
<li>提取<code>vender</code></li>
<li><code>hash</code> -&gt; <code>chunkHash</code></li>
<li>提取 <code>webpack runtime 与 manifest</code> </li>
<li>使用 <code>NamedChunksPlugin</code>: 使Chunk的<code>id</code>以<code>name</code>命名, 不再分配打包顺序数字</li>
<li>使用 <code>NamedModule是Plugin</code>: 使Module的<code>id</code>以<code>相对路径</code>命名, 不再分配打包顺序数字</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: <span class="string">'./src/foo'</span>,</span><br><span class="line">    vendor: [<span class="string">'react'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    <span class="comment">// 以[chunkhash]代替[hash]</span></span><br><span class="line">    filename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.NamedChunksPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">    <span class="comment">// 提取公用代码, 此例中为react库的代码</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'vendor'</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 提取manifest与runtime</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'manifest'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="webpack多页面应用"><a href="#webpack多页面应用" class="headerlink" title="webpack多页面应用"></a>webpack多页面应用</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>多入口 entry</li>
<li>多页面 html</li>
<li>每个页面不同的 chunk (js, css)</li>
<li>每个页面需要不同的webpack参数</li>
</ul>
<h3 id="多配置"><a href="#多配置" class="headerlink" title="多配置"></a>多配置</h3><blockquote>
<p>方法:</p>
</blockquote>
<ul>
<li><code>parallel-webpack</code>: 并行处理没有关联的多份配置(比如同时打包10个页面)</li>
</ul>
<blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>可以使用<code>parallel-webpack</code>来提高打包速度</li>
<li>配置更加独立, 灵活</li>
</ul>
<blockquote>
<p>缺点:</p>
</blockquote>
<ul>
<li>不能多页面之间共享代码, 不能使用长缓存, 用户加载效率低</li>
</ul>
<blockquote>
<p>配置:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多页面多配置的parallel-webpack并行打包多页面的优化</span></span><br><span class="line"><span class="comment">// npm install parallel-webpack --save-dev</span></span><br><span class="line"><span class="comment">// node_modules/parallel-webpack/bin/run.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    react: [<span class="string">'react'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'js/[name].[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: ExtractTextWebpack.extract(&#123;</span><br><span class="line">          fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">          use: <span class="string">'css-loader'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpack(&#123;</span><br><span class="line">      filename: <span class="string">'css/[name].[hash].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> CleanWebpack(path.resolve(__dirname, <span class="string">'dist'</span>)),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'react'</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 每个页面的配置生成函数</span></span><br><span class="line"><span class="keyword">const</span> generatePage = <span class="function"><span class="keyword">function</span> (<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                                 title = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 entry = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 template = <span class="string">'./src/index.html'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 name = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 chunks = []</span></span></span><br><span class="line"><span class="function"><span class="params">                               &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    entry,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        chunks,</span><br><span class="line">        template,</span><br><span class="line">        filename: name + <span class="string">'.html'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 生成每个页面的配置数组</span></span><br><span class="line"><span class="keyword">const</span> pages = [</span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page A'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      a: <span class="string">'./src/pages/a'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'a'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'a'</span>]</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page B'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      b: <span class="string">'./src/pages/b'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'b'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'b'</span>]</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page C'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      c: <span class="string">'./src/pages/c'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'c'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'c'</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模块返回一个配置数组, 每一项都是每个页面的单独配置和baseConfig的一个合并</span></span><br><span class="line"><span class="built_in">module</span>.exports = pages.map(<span class="function"><span class="params">page</span> =&gt;</span> merge(baseConfig, page))</span><br></pre></td></tr></table></figure>
<h3 id="单配置-共享配置"><a href="#单配置-共享配置" class="headerlink" title="单配置(共享配置)"></a>单配置(共享配置)</h3><blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>可以共享各个 <code>entry</code> 之间的公用代码</li>
</ul>
<blockquote>
<p>缺点: </p>
</blockquote>
<ul>
<li>打包速度比较慢</li>
<li>输出的内容比较复杂</li>
</ul>
<blockquote>
<p>配置: </p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> baseConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    react: [<span class="string">'react'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'js/[name].[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: ExtractTextWebpack.extract(&#123;</span><br><span class="line">          fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">          use: <span class="string">'css-loader'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpack(&#123;</span><br><span class="line">      filename: <span class="string">'css/[name].[hash].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> CleanWebpack(path.resolve(__dirname, <span class="string">'dist'</span>)),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'react'</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generatePage = <span class="function"><span class="keyword">function</span> (<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                                 title = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 entry = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 template = <span class="string">'./src/index.html'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 name = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 chunks = []</span></span></span><br><span class="line"><span class="function"><span class="params">                               &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    entry,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        chunks,</span><br><span class="line">        template,</span><br><span class="line">        title,</span><br><span class="line">        filename: name + <span class="string">'.html'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pages = [</span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page A'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      a: <span class="string">'./src/pages/a'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'a'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'a'</span>]</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page B'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      b: <span class="string">'./src/pages/b'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'b'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'b'</span>]</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  generatePage(&#123;</span><br><span class="line">    title: <span class="string">'page C'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      c: <span class="string">'./src/pages/c'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">'c'</span>,</span><br><span class="line">    chunks: [<span class="string">'react'</span>, <span class="string">'c'</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多页面单配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = merge([baseConfig].concat(pages))</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2018/03/07/webpack01/" class="next">上一篇</a><a href="/2018/03/20/vue-jd自适应方案设计/" class="prev">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">choteewang@qq.com</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>