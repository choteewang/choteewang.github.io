<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> vue 2.5+ 外卖 webapp · choteewang</title><meta name="description" content="vue 2.5+ 外卖 webapp - choteewang@qq.com"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="choteewang"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">CHOTEE'S BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">LIST</a></li><li class="nav-list-item"><a href="https://github.com/choteewang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">vue 2.5+ 外卖 webapp</h1><div class="post-info">2018年1月27日</div><div class="post-content"><h1 id="vue-2-5-外卖-webapp"><a href="#vue-2-5-外卖-webapp" class="headerlink" title="vue 2.5+ 外卖 webapp"></a>vue 2.5+ 外卖 webapp</h1><h3 id="presentation"><a href="#presentation" class="headerlink" title="presentation"></a>presentation</h3><p><img src="https://i.loli.net/2018/01/27/5a6c4030d5043.gif" alt="pre1"><br><img src="https://i.loli.net/2018/01/27/5a6c42ac6c4bb.gif" alt="pre2"><br><img src="https://i.loli.net/2018/01/27/5a6c42a8e08a0.gif" alt="3"><br><img src="https://i.loli.net/2018/01/27/5a6c42a88b9af.gif" alt="4"><br><img src="https://i.loli.net/2018/01/27/5a6c42a864868.gif" alt="5"></p>
<h3 id="tech"><a href="#tech" class="headerlink" title="tech"></a>tech</h3><ul>
<li>Vue 2.5+</li>
<li>Vue-router 3.0+</li>
<li>Full-ES6-Syntax-Cover</li>
<li>stylus css预处理器</li>
<li>axios</li>
<li>better-scroll</li>
<li>eslint</li>
<li>移动端flex布局, inline-block布局, css-sticky-footer</li>
<li>media query 实现移动端1px边框和背景图片切换</li>
</ul>
<h2 id="High-Light"><a href="#High-Light" class="headerlink" title="High Light"></a>High Light</h2><h3 id="两侧同步滚动-算法实现"><a href="#两侧同步滚动-算法实现" class="headerlink" title="两侧同步滚动,算法实现"></a>两侧同步滚动,算法实现</h3><h4 id="效果演示"><a href="#效果演示" class="headerlink" title="效果演示"></a>效果演示</h4><p><img src="https://i.loli.net/2018/01/27/5a6c42ac6c4bb.gif" alt="pre2"></p>
<h4 id="goods-vue中的code"><a href="#goods-vue中的code" class="headerlink" title="goods.vue中的code"></a>goods.vue中的code</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"menu-wrapper"</span> <span class="attr">ref</span>=<span class="string">"menuWrapper"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item,index) in goods"</span> <span class="attr">:key</span>=<span class="string">"index"</span> <span class="attr">class</span>=<span class="string">"menu-item"</span> <span class="attr">:class</span>=<span class="string">"&#123; current : currentIndex === index &#125;"</span> @<span class="attr">click</span>=<span class="string">"selectMenu(index,$event)"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"foods-wrapper"</span> <span class="attr">ref</span>=<span class="string">"foodsWrapper"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item,index) in goods"</span> <span class="attr">:key</span>=<span class="string">"index"</span> <span class="attr">class</span>=<span class="string">"food-list"</span> <span class="attr">ref</span>=<span class="string">"foodList"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 存放所有dom高度的数组</span></span><br><span class="line">    listHeight: [],</span><br><span class="line">    <span class="comment">// 存放</span></span><br><span class="line">    scrollY: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,</span><br><span class="line">created() &#123;</span><br><span class="line">  axios.get(<span class="string">'/api/goods'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.data.errno === ERR_OK) &#123;</span><br><span class="line">      <span class="keyword">this</span>.goods = res.data.data;</span><br><span class="line">      <span class="comment">// 先让this.goods更新template中的dom后,iscroll才能准确计算出dom高度,dom的更新在vue中是异步的,所以在nextTick异步更新后再用iScroll算高度</span></span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._initScroll();</span><br><span class="line">        <span class="keyword">this</span>._calculateHeight();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  _initScroll() &#123;</span><br><span class="line">    <span class="comment">// 用BScroll初始化左侧栏</span></span><br><span class="line">    <span class="keyword">this</span>.menuScroll = <span class="keyword">new</span> BScroll(<span class="keyword">this</span>.$refs.menuWrapper, &#123;</span><br><span class="line">      click: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 用BScroll初始化右侧栏</span></span><br><span class="line">    <span class="keyword">this</span>.foodScroll = <span class="keyword">new</span> BScroll(<span class="keyword">this</span>.$refs.foodsWrapper, &#123;</span><br><span class="line">      click: <span class="literal">true</span>,</span><br><span class="line">      probeType: <span class="number">3</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 右侧栏滚动时实时返回y值</span></span><br><span class="line">    <span class="keyword">this</span>.foodScroll.on(<span class="string">'scroll'</span>, pos =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.scrollY = <span class="built_in">Math</span>.abs(<span class="built_in">Math</span>.round(pos.y));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 将 ref为foodList li标签 累加高度 组成数组</span></span><br><span class="line">  _calculateHeight() &#123;</span><br><span class="line">    <span class="keyword">const</span> listHeight = <span class="keyword">this</span>.listHeight;</span><br><span class="line">    <span class="keyword">const</span> foodList = <span class="keyword">this</span>.$refs.foodList;</span><br><span class="line">    <span class="keyword">var</span> height = <span class="number">0</span>;</span><br><span class="line">    listHeight.push(height);</span><br><span class="line">    foodList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">      height += v.clientHeight;</span><br><span class="line">      listHeight.push(height);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 左侧li点击时传入index,滚动到index对应的右侧menu</span></span><br><span class="line">  selectMenu(index) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="keyword">this</span>.$refs.foodList[index];</span><br><span class="line">    <span class="comment">// BScorll库方法Bscroll.ScrollToElement(el,time)</span></span><br><span class="line">    <span class="keyword">this</span>.foodScroll.scrollToElement(el, <span class="number">300</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">// 根据 外层容器foodsWrapper的scrollTop值 所处于 listHeight数组 的区间,来返回当前左侧栏被选中的index</span></span><br><span class="line">    currentIndex() &#123;</span><br><span class="line">      <span class="keyword">let</span> scrollY = <span class="keyword">this</span>.scrollY;</span><br><span class="line">      <span class="keyword">const</span> listHeight = <span class="keyword">this</span>.listHeight;</span><br><span class="line">      <span class="keyword">const</span> length = listHeight.length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> top = listHeight[i];</span><br><span class="line">        <span class="keyword">const</span> bottom = listHeight[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (!bottom || (scrollY &gt;= top &amp;&amp; scrollY &lt; bottom)) &#123;</span><br><span class="line">          <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="购物车-数据流实现"><a href="#购物车-数据流实现" class="headerlink" title="购物车 - 数据流实现"></a>购物车 - 数据流实现</h3><p><img src="https://i.loli.net/2018/01/27/5a6c34653fb80.png" alt="vue-sell购物车"></p>
<h3 id="购物小球-数据结构实现"><a href="#购物小球-数据结构实现" class="headerlink" title="购物小球 - 数据结构实现"></a>购物小球 - 数据结构实现</h3><h4 id="效果演示-1"><a href="#效果演示-1" class="headerlink" title="效果演示"></a>效果演示</h4><p><img src="https://i.loli.net/2018/01/27/5a6c4030d5043.gif" alt="pre1"></p>
<h4 id="事件派发数据流"><a href="#事件派发数据流" class="headerlink" title="事件派发数据流"></a>事件派发数据流</h4><p><img src="https://i.loli.net/2018/01/27/5a6c3467ed132.png" alt="vue-sell小球缓落动画"></p>
<h4 id="shopcart中的数据结构"><a href="#shopcart中的数据结构" class="headerlink" title="shopcart中的数据结构"></a>shopcart中的数据结构</h4><p>shopcart中采用一个<code>balls</code>数组用来沟通<code>cartcontrol.vue</code>传递的<code>event.target</code>的dom元素与动画小球dom元素的联系</p>
<p><img src="https://i.loli.net/2018/01/27/5a6c34694efe5.jpg" alt=""></p>
<h4 id="shopcart-vue中的code"><a href="#shopcart-vue中的code" class="headerlink" title="shopcart.vue中的code"></a>shopcart.vue中的code</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball-container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"drop"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(ball,index) in balls"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span> </span></span><br><span class="line"><span class="tag">    @<span class="attr">before-enter</span>=<span class="string">"beforeDrop"</span> </span></span><br><span class="line"><span class="tag">    @<span class="attr">enter</span>=<span class="string">"dropping"</span> </span></span><br><span class="line"><span class="tag">    @<span class="attr">after-enter</span>=<span class="string">"endDropping"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball-outer"</span> <span class="attr">v-show</span>=<span class="string">"ball.show"</span> <span class="attr">:num</span>=<span class="string">"ball.num"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball-inner"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      balls: [</span><br><span class="line">        &#123;</span><br><span class="line">          num: <span class="number">1</span>,</span><br><span class="line">          show: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          num: <span class="number">2</span>,</span><br><span class="line">          show: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          num: <span class="number">3</span>,</span><br><span class="line">          show: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          num: <span class="number">4</span>,</span><br><span class="line">          show: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          num: <span class="number">5</span>,</span><br><span class="line">          show: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    对goods页面调用的$refs.shopcart.drop(el)做反应,开始小球掉落</span></span><br><span class="line"><span class="comment">    找到this.balls中第一个ball.show == false的项</span></span><br><span class="line"><span class="comment">    将此项开始的show置为true,el属性设置为传入的el-dom</span></span><br><span class="line"><span class="comment">    开始掉落此球</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    drop(el) &#123;</span><br><span class="line">      <span class="keyword">let</span> ballSelected = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">const</span> truth = <span class="keyword">this</span>.balls.some(<span class="function"><span class="keyword">function</span>(<span class="params">ball</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ball.show === <span class="literal">false</span>) &#123;</span><br><span class="line">          ballSelected = ball;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (truth) &#123;</span><br><span class="line">        ballSelected.el = el;</span><br><span class="line">        ballSelected.show = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeDrop(el) &#123;</span><br><span class="line">      <span class="comment">// Start通过绑定自定义属性拿到event.target,改进了原版算法</span></span><br><span class="line">      <span class="keyword">const</span> elNum = <span class="built_in">parseInt</span>(el.getAttribute(<span class="string">'num'</span>));</span><br><span class="line">      <span class="keyword">let</span> ballEl = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">this</span>.balls.some(<span class="function"><span class="keyword">function</span>(<span class="params">ball</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ball.num === elNum) &#123;</span><br><span class="line">          ballEl = ball.el;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// End通过绑定自定义属性拿到event.target,改进了原版算法</span></span><br><span class="line">      <span class="keyword">let</span> rect = ballEl.getBoundingClientRect();</span><br><span class="line">      <span class="keyword">let</span> x = rect.left - <span class="number">22</span>;</span><br><span class="line">      <span class="keyword">let</span> y = -(<span class="built_in">window</span>.innerHeight - rect.top - <span class="number">42</span>);</span><br><span class="line">      el.style.display = <span class="string">'block'</span>;</span><br><span class="line">      el.style.webkitTransform = <span class="string">`translate3d(0,<span class="subst">$&#123;y&#125;</span>px,0)`</span>;</span><br><span class="line">      el.style.transform = <span class="string">`translate3d(0,<span class="subst">$&#123;y&#125;</span>px,0)`</span>;</span><br><span class="line">      <span class="keyword">let</span> inner = el.firstElementChild;</span><br><span class="line">      inner.style.webkitTransform = <span class="string">`translate3d(<span class="subst">$&#123;x&#125;</span>px,0,0)`</span>;</span><br><span class="line">      inner.style.transform = <span class="string">`translate3d(<span class="subst">$&#123;x&#125;</span>px,0,0)`</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    dropping(el, done) &#123;</span><br><span class="line">      <span class="comment">// 强制浏览器重绘</span></span><br><span class="line">      <span class="comment">/* eslint-disable no-unused-vars */</span></span><br><span class="line">      <span class="keyword">let</span> rf = el.offsetHeight;</span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        el.style.webkitTransform = <span class="string">'translate3d(0,0,0)'</span>;</span><br><span class="line">        el.style.transform = <span class="string">'translate3d(0,0,0)'</span>;</span><br><span class="line">        <span class="keyword">let</span> inner = el.firstElementChild;</span><br><span class="line">        inner.style.webkitTransform = <span class="string">'translate3d(0,0,0)'</span>;</span><br><span class="line">        inner.style.transform = <span class="string">'translate3d(0,0,0)'</span>;</span><br><span class="line">        el.addEventListener(<span class="string">'transitionend'</span>, done);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    endDropping(el) &#123;</span><br><span class="line">      <span class="comment">// Start通过绑定自定义属性拿到el,改进了原版算法</span></span><br><span class="line">      <span class="keyword">const</span> elNum = <span class="built_in">parseInt</span>(el.getAttribute(<span class="string">'num'</span>));</span><br><span class="line">      <span class="keyword">this</span>.balls.some(<span class="function"><span class="keyword">function</span>(<span class="params">ball</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ball.num === elNum) &#123;</span><br><span class="line">          ball.show = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      el.style.display = <span class="string">'none'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// End通过绑定自定义属性拿到el,改进了原版算法</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外层负责纵向y轴位移</span></span><br><span class="line">.ball-container</span><br><span class="line">  .ball-outer</span><br><span class="line">    <span class="attribute">position</span> fixed</span><br><span class="line">    <span class="attribute">left</span> <span class="number">32px</span></span><br><span class="line">    <span class="attribute">bottom</span> <span class="number">32px</span></span><br><span class="line">    <span class="attribute">z-index</span> <span class="number">200</span></span><br><span class="line">    <span class="attribute">transition</span> all <span class="number">0.4s</span> cubic-bezier(<span class="number">0.17</span>, -<span class="number">0.34</span>, <span class="number">0.75</span>, <span class="number">0.46</span>)</span><br><span class="line">    <span class="comment">// 内层负责横向x轴位移</span></span><br><span class="line">    .ball-inner</span><br><span class="line">      <span class="attribute">width</span> <span class="number">16px</span></span><br><span class="line">      <span class="attribute">height</span> <span class="number">16px</span></span><br><span class="line">      <span class="attribute">border-radius</span> <span class="number">50%</span></span><br><span class="line">      <span class="attribute">background</span> rgb(<span class="number">0</span>, <span class="number">160</span>, <span class="number">220</span>)</span><br><span class="line">      <span class="attribute">transition</span> all <span class="number">0.4s</span></span><br></pre></td></tr></table></figure>
<h3 id="根据scroll时动态获取的y轴偏移值设置back按钮的位置和颜色"><a href="#根据scroll时动态获取的y轴偏移值设置back按钮的位置和颜色" class="headerlink" title="根据scroll时动态获取的y轴偏移值设置back按钮的位置和颜色"></a>根据scroll时动态获取的y轴偏移值设置back按钮的位置和颜色</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// food.vue</span></span><br><span class="line">show() &#123;</span><br><span class="line">  <span class="keyword">this</span>.showFlag = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 每次打开food页面默认显示所有有评论的评价</span></span><br><span class="line">  <span class="keyword">this</span>.selectType = ALL;</span><br><span class="line">  <span class="keyword">this</span>.onlyContent = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 每次打开food页面初始化betterScroll</span></span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.scroll) &#123;</span><br><span class="line">      <span class="keyword">this</span>.scroll = <span class="keyword">new</span> BScroll(<span class="keyword">this</span>.$refs.foodWrapper, &#123;</span><br><span class="line">        click: <span class="literal">true</span>,</span><br><span class="line">        probeType: <span class="number">3</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.scroll.refresh();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 每次进入food页面时,先定义一次back元素位置</span></span><br><span class="line">    <span class="keyword">let</span> transform = <span class="built_in">window</span>.getComputedStyle(</span><br><span class="line">      <span class="keyword">this</span>.$refs.foodWrapper.firstElementChild,</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    ).transform;</span><br><span class="line">    <span class="comment">//截取字符串,找到被滚动的.food-content元素的y偏移量</span></span><br><span class="line">    <span class="comment">//这个值相当于translateY的值</span></span><br><span class="line">    <span class="comment">//console.log(transform); // matrix(1, 0, 0, 1, 0, -55.7028)</span></span><br><span class="line">    <span class="keyword">if</span> (transform.indexOf(<span class="string">'-'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs.back.style.transform = <span class="string">`translate3d(0,0,0)`</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      transform = transform.slice(transform.indexOf(<span class="string">'-'</span>) + <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">this</span>.$refs.back.style.transform = <span class="string">`translate3d(0,<span class="subst">$&#123;transform&#125;</span>px,0)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据scroll时动态获取的y轴偏移值设置back按钮的位置和颜色</span></span><br><span class="line">    <span class="keyword">this</span>.scroll.on(<span class="string">'scroll'</span>, pos =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (pos.y &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> transform = <span class="built_in">window</span>.getComputedStyle(</span><br><span class="line">          <span class="keyword">this</span>.$refs.foodWrapper.firstElementChild,</span><br><span class="line">          <span class="literal">null</span></span><br><span class="line">        ).transform;</span><br><span class="line">        <span class="built_in">console</span>.log(transform); <span class="comment">//</span></span><br><span class="line">        <span class="keyword">this</span>.$refs.back.style.transform = <span class="string">`translate3d(0,<span class="subst">$&#123;-pos.y&#125;</span>px,0)`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> style = <span class="keyword">this</span>.$refs.back.firstElementChild.style;</span><br><span class="line">      style.color = pos.y &lt; -<span class="built_in">window</span>.innerWidth + <span class="number">30</span> ? <span class="string">'#000'</span> : <span class="string">'#fff'</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="seller-vue页面的页面dom初始化"><a href="#seller-vue页面的页面dom初始化" class="headerlink" title="seller.vue页面的页面dom初始化"></a>seller.vue页面的页面dom初始化</h3><p>在<code>seller.vue</code>初始化BScroll中遇到的问题,页面必须拿到<code>seller</code>才能初始化dom</p>
<p><code>seller</code>是在app.vue中发ajax请求异步得到后通过<code>v-bind</code>传入<code>seller.vue</code>中的</p>
<p>在刷新页面时要使用<code>watch</code>监视传递的<code>seller</code>异步获取完成</p>
<p>在切换路由时<code>app.vue</code>不会进行ajax请求,但vue实例的生命周期会重新加载一次, 所以会在<code>created</code>或<code>mounted</code>里再写入初始化<code>BScroll</code>代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// seller.vue</span></span><br><span class="line">props: &#123;</span><br><span class="line">  seller: &#123;</span><br><span class="line">    type: <span class="built_in">Object</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">created() &#123;</span><br><span class="line">  <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 若刷新,触发顺序1</span></span><br><span class="line">    <span class="comment">// 在不刷新只切换路由时由于app.vue不再触发ajax请求只触发此步</span></span><br><span class="line">    <span class="comment">// console.log('created initScroll'); </span></span><br><span class="line">    <span class="keyword">this</span>._initScroll();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">watch: &#123;</span><br><span class="line">  seller: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 若刷新,触发顺序2,因为app.vue的ajax是异步请求</span></span><br><span class="line">    <span class="comment">//console.log('watch initScroll'); </span></span><br><span class="line">    <span class="keyword">this</span>._initScroll();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  _initScroll() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(); <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.scroll) &#123;</span><br><span class="line">      <span class="keyword">this</span>.scroll = <span class="keyword">new</span> BScroll(<span class="keyword">this</span>.$refs.sellerWrapper, &#123;</span><br><span class="line">        click: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.scroll.refresh();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="Tips-amp-Util"><a href="#Tips-amp-Util" class="headerlink" title="Tips &amp; Util"></a>Tips &amp; Util</h2><h3 id="视网膜屏1px边框实现"><a href="#视网膜屏1px边框实现" class="headerlink" title="视网膜屏1px边框实现"></a>视网膜屏1px边框实现</h3><p>前置知识:<a href="http://www.zhangxinxu.com/wordpress/2012/08/window-devicepixelratio/" target="_blank" rel="noopener">设备像素比devicePixelRatio简单介绍</a></p>
<p>移动端的1px边框到了视网膜屏因为要乘以像素比,所以实际大小要几倍大于1px(比如iphone6的像素比是2,则2*1px=2px)</p>
<p>因此, 1px边框可以由<code>after伪类</code>加上,然后用<code>@media</code>根据不同的像素比查询来缩放<code>after伪类</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个mixin加给要添加伪类的父类</span></span><br><span class="line"><span class="function"><span class="title">border-1px</span><span class="params">(<span class="variable">$color</span>)</span></span></span><br><span class="line">   <span class="attribute">position</span>: relative</span><br><span class="line">   &amp;::after</span><br><span class="line">     <span class="attribute">position</span>: absolute</span><br><span class="line">     <span class="attribute">left</span>: <span class="number">0</span></span><br><span class="line">     <span class="attribute">bottom</span>: <span class="number">0</span></span><br><span class="line">     <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line">     <span class="attribute">content</span>:<span class="string">''</span></span><br><span class="line">     <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="variable">$color</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@media (min-device-pixel-ratio : <span class="number">1.5</span>),(-webkit-min-device-pixel-ratio : <span class="number">1.5</span>)</span><br><span class="line">  <span class="comment">/* 1.5*7 ~= 1 */</span></span><br><span class="line">  .<span class="attribute">border</span>-<span class="number">1px</span></span><br><span class="line">    &amp;::after</span><br><span class="line">      <span class="attribute">transform</span>: scaleY(<span class="number">0.7</span>)</span><br><span class="line">      -webkit-<span class="attribute">transform</span>: scaleY(<span class="number">0.7</span>)</span><br><span class="line"></span><br><span class="line">@media (min-device-pixel-ratio : <span class="number">2.0</span>),(-webkit-min-device-pixel-ratio : <span class="number">2.0</span>)</span><br><span class="line">  <span class="comment">/* 2.0*5 = 1 */</span></span><br><span class="line">  .<span class="attribute">border</span>-<span class="number">1px</span></span><br><span class="line">    &amp;::after</span><br><span class="line">      <span class="attribute">transform</span>: scaleY(<span class="number">0.5</span>)</span><br><span class="line">      -webkit-<span class="attribute">transform</span>: scaleY(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="根据不同的设备像素比应用不同图片"><a href="#根据不同的设备像素比应用不同图片" class="headerlink" title="根据不同的设备像素比应用不同图片"></a>根据不同的设备像素比应用不同图片</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">bg-image</span><span class="params">(<span class="variable">$url</span>)</span></span></span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="variable">$url</span> + <span class="string">'@2x.png'</span>)</span><br><span class="line"></span><br><span class="line">  @media (-webkit-min-device-pixel-ratio: <span class="number">3</span>), (min-device-pixel-ratio: <span class="number">3</span>)</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="variable">$url</span> + <span class="string">'@3x.png'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="多行文本的垂直居中"><a href="#多行文本的垂直居中" class="headerlink" title="多行文本的垂直居中"></a>多行文本的垂直居中</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.menu-wrapper</span><br><span class="line">    <span class="attribute">display</span> table</span><br><span class="line">    .text</span><br><span class="line">    <span class="attribute">display</span> table-cell</span><br><span class="line">    <span class="attribute">vertical-align</span> middle</span><br></pre></td></tr></table></figure>
<h3 id="背景模糊-iPhone独占"><a href="#背景模糊-iPhone独占" class="headerlink" title="背景模糊(iPhone独占)"></a>背景模糊(iPhone独占)</h3><p><code>backdrop-filter blur(10px)</code></p>
<h3 id="padding-margin-百分比实现高度自适应"><a href="#padding-margin-百分比实现高度自适应" class="headerlink" title="padding,margin 百分比实现高度自适应"></a>padding,margin 百分比实现高度自适应</h3><p>当margin/padding取形式为百分比的值时，无论是left/right，还是top/bottom，都是以父元素的width为参照物的</p>
<p>自适应设备宽度的方形图片</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.image-header</span><br><span class="line">  <span class="attribute">position</span> relative</span><br><span class="line">  <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">0</span></span><br><span class="line">  <span class="comment">// padding设置100%时按宽度计算</span></span><br><span class="line">  <span class="attribute">padding-top</span> <span class="number">100%</span></span><br><span class="line">  img</span><br><span class="line">    <span class="comment">// 图像设置position:absolute的原因是父元素height是0</span></span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">top</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">left</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">100%</span></span><br></pre></td></tr></table></figure>
<h3 id="inline-block布局代替float布局"><a href="#inline-block布局代替float布局" class="headerlink" title="inline-block布局代替float布局"></a>inline-block布局代替float布局</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.father</span><br><span class="line">    <span class="comment">// 父元素设置字体为0避免son1与son2的html代码换行造成的空格</span></span><br><span class="line">    <span class="attribute">font-size</span> <span class="number">0</span></span><br><span class="line">    .son1</span><br><span class="line">        <span class="attribute">display</span> inline-block</span><br><span class="line">        <span class="attribute">vertical-align</span> top</span><br><span class="line">        <span class="attribute">margin-right</span> <span class="number">8px</span></span><br><span class="line">    .son2</span><br><span class="line">        <span class="attribute">display</span> inline-block</span><br><span class="line">        <span class="attribute">vertical-align</span> top</span><br></pre></td></tr></table></figure>
<h3 id="css-sticky-footer"><a href="#css-sticky-footer" class="headerlink" title="css-sticky-footer"></a>css-sticky-footer</h3><p>永远固定在底端的footer,在内容高度不足时依然固定在底端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.body</span><br><span class="line">    <span class="attribute">display</span> flex</span><br><span class="line">    <span class="attribute">min-height</span> <span class="number">100%</span></span><br><span class="line">    .<span class="attribute">content</span></span><br><span class="line">    <span class="attribute">flex</span> <span class="number">1</span></span><br><span class="line">    .footer</span><br><span class="line">    <span class="attribute">height</span> <span class="number">50px</span></span><br></pre></td></tr></table></figure>
<h3 id="格式化日期的工具方法"><a href="#格式化日期的工具方法" class="headerlink" title="格式化日期的工具方法"></a>格式化日期的工具方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">formatDate</span>(<span class="params">timestamp, formatType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> str = formatType <span class="comment">// YYYY-MM-DD HH:mm</span></span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp)</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(Y+)/</span>.test(str)) &#123;</span><br><span class="line">    str = str.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, date.getFullYear().toString().slice(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> transObj = &#123;</span><br><span class="line">    <span class="string">'M+'</span>: date.getMonth() + <span class="number">1</span>,</span><br><span class="line">    <span class="string">'D+'</span>: date.getDate(),</span><br><span class="line">    <span class="string">'H+'</span>: date.getHours(),</span><br><span class="line">    <span class="string">'m+'</span>: date.getMinutes()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> transObj) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`(<span class="subst">$&#123;key&#125;</span>)`</span>).test(str)) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = transObj[key].toString()</span><br><span class="line">      str = str.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, padLeftZero(value))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 补0函数,传入12-&gt;12,传入2-&gt;02</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">padLeftZero</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">'00'</span>+value).slice(value.length)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveToLocalStorage</span>(<span class="params">id, key, value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// __seller__可替换为其他命名空间名</span></span><br><span class="line">  <span class="keyword">let</span> seller = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">'__seller__'</span>))</span><br><span class="line">  <span class="keyword">if</span> (!seller) &#123;</span><br><span class="line">    seller = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!seller[id]) &#123;</span><br><span class="line">    seller[id] = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  seller[id][key] = value</span><br><span class="line">  <span class="built_in">window</span>.localStorage.setItem(<span class="string">'__seller__'</span>, <span class="built_in">JSON</span>.stringify(seller))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">readFromLocalStorage</span>(<span class="params">id, key, def</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// __seller__可替换为其他命名空间名</span></span><br><span class="line">  <span class="keyword">const</span> seller = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">'__seller__'</span>))</span><br><span class="line">  <span class="keyword">if</span> (!seller) &#123;</span><br><span class="line">    <span class="keyword">return</span> def</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!seller[id]) &#123;</span><br><span class="line">    <span class="keyword">return</span> def</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> seller[id][key] || def</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="queryString-to-Object"><a href="#queryString-to-Object" class="headerlink" title="queryString to Object"></a>queryString to Object</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">urlSerialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> search = <span class="built_in">window</span>.location.search</span><br><span class="line">  <span class="comment">// ?id=123&amp;a=b</span></span><br><span class="line">  <span class="keyword">const</span> regExp = <span class="regexp">/[?&amp;][^?&amp;]+=[^?&amp;]+/g</span></span><br><span class="line">  <span class="keyword">const</span> matches = search.match(regExp)</span><br><span class="line">  <span class="comment">// ['?id=123','&amp;a=b']</span></span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (matches) &#123;</span><br><span class="line">    matches.forEach(<span class="function">(<span class="params">match</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tempArr = match.slice(<span class="number">1</span>).split(<span class="string">'='</span>)</span><br><span class="line">      <span class="keyword">const</span> key = <span class="built_in">decodeURIComponent</span>(tempArr[<span class="number">0</span>])</span><br><span class="line">      <span class="keyword">const</span> value = <span class="built_in">decodeURIComponent</span>(tempArr[<span class="number">1</span>])</span><br><span class="line">      obj[key] = value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h3><p><a href="https://github.com/choteewang/vue-sell" target="_blank" rel="noopener">https://github.com/choteewang/vue-sell</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/10/元素居中/" class="next">上一篇</a><a href="/2018/02/10/async1/" class="prev">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">choteewang@qq.com</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>