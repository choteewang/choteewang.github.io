<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 正反馈系列:《JavaScript高级程序设计》表单脚本 · choteewang</title><meta name="description" content="正反馈系列:《JavaScript高级程序设计》表单脚本 - choteewang@qq.com"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="choteewang"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">CHOTEE'S BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">LIST</a></li><li class="nav-list-item"><a href="https://github.com/choteewang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">正反馈系列:《JavaScript高级程序设计》表单脚本</h1><div class="post-info">2017年12月30日</div><div class="post-content"><h2 id="表单的基础知识"><a href="#表单的基础知识" class="headerlink" title="表单的基础知识"></a>表单的基础知识</h2><p>在HTML中，表单是由<code>&lt;form&gt;</code>元素来表示的，而在JavaScript中，表单对应的则是<code>HTMLFormElement</code>类型。<code>HTMLFormElement</code>继承了<code>HTMLElement</code>，因而与其他HTML元素具有相同的默认属性。不过，<code>HTMLFormElement</code>也有它自己下列独有的属性和方法。</p>
<ul>
<li><code>acceptCharset</code>：服务器能够处理的字符集；等价于HTML中的<code>accept-charset</code>特性。</li>
<li><code>action</code>：接受请求的URL；等价于HTML中的<code>action</code>特性。</li>
<li><code>elements</code>：表单中所有控件的集合（<code>HTMLCollection</code>）。</li>
<li><code>enctype</code>：请求的编码类型；等价于HTML中的<code>enctype</code>特性。</li>
<li><code>length</code>：表单中控件的数量。</li>
<li><code>method</code>：要发送的HTTP请求类型，通常是”get”或”post”；等价于HTML的<code>method</code>特性。</li>
<li><code>name</code>：表单的名称；等价于HTML的<code>name</code>特性。</li>
<li><code>reset()</code>：将所有表单域重置为默认值。</li>
<li><code>submit()</code>：提交表单。</li>
<li><code>target</code>：用于发送请求和接收响应的窗口名称；等价于HTML的<code>target</code>特性。</li>
</ul>
<blockquote>
<p>取得<code>&lt;form&gt;</code>元素引用的方式有好几种。其中最常见的方式就是将它看成与其他元素一样，并为其添加<code>id</code>特性，然后再像下面这样使用<code>getElementById()</code>方法找到它。其次，通过<code>document.forms</code>可以取得页面中所有的表单。在这个集合中，可以通过<code>数值索引</code>或<code>name</code>值来取得特定的表单</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过id得到form对象</span></span><br><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"form1"</span>);</span><br><span class="line"><span class="comment">//取得页面中的第一个表单 </span></span><br><span class="line"><span class="keyword">var</span> firstForm = <span class="built_in">document</span>.forms[<span class="number">0</span>]; </span><br><span class="line"><span class="comment">//取得页面中名称为"form2"的表单</span></span><br><span class="line"><span class="keyword">var</span> myForm = <span class="built_in">document</span>.forms[<span class="string">"form2"</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>另外，在较早的浏览器或者那些支持向后兼容的浏览器中，也会把每个设置了<code>name</code>特性的表单作为属性保存在<code>document</code>对象中。例如，通过<code>document.form2</code>可以访问到名为<code>form2</code>的表单。不过，我们不推荐使用这种方式：一是容易出错，二是将来的浏览器可能会不支持。<br>可以同时为表单指定id和name属性，但它们的值不一定相同。</p>
</blockquote>
<h3 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h3><p>只要我们单击以下代码生成的按钮，就可以提交表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通用提交按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit Form"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 自定义提交按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 图像按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"image"</span> <span class="attr">src</span>=<span class="string">"graphic.gif"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只要表单中存在上面列出的任何一种按钮，按回车键就可以提交该表单。（<code>textarea</code>是一个例外，在文本区中回车会换行。）</p>
<p>以这种方式提交表单时，浏览器会在将请求发送给服务器之前触发<code>submit</code>事件(必须有上述按钮才能触发<code>submit</code>事件,js方法触发<code>form.submit()</code>也可以提交,但并没有触发<code>submit</code>事件,要区别)。这样，我们就有机会验证表单数据，并据以决定是否允许表单提交。阻止这个事件的默认行为就可以取消表单提交。例如，下列代码会阻止表单提交。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line">EventUtil.addHandler(form, <span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//取得事件对象 </span></span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//阻止默认事件 </span></span><br><span class="line">  EventUtil.preventDefault(event);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以编程方式调用<code>form.submit()</code>方法也可以提交表单。而且，这种方式无需表单包含提交按钮，任何时候都可以正常提交表单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交表单</span></span><br><span class="line">form.submit();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在以调用 <code>form.submit()</code>方法的形式提交表单时，不会触发 <code>submit</code> 事件，因此要记得在调用此方法之前先验证表单数据。</p>
<p>提交表单时可能出现的最大问题，就是重复提交表单。解决这一问题的办法有两个：在第一次提交表单后就禁用提交按钮，或者利用<code>onsubmit</code>事件处理程序取消后续的表单提交操作。</p>
</blockquote>
<h3 id="重置表单"><a href="#重置表单" class="headerlink" title="重置表单"></a>重置表单</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通用重置按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"Reset Form"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 自定义重置按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"reset"</span>&gt;</span>Reset Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line">EventUtil.addHandler(form, <span class="string">"reset"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//取得事件对象 </span></span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//阻止表单重置 </span></span><br><span class="line">  EventUtil.preventDefault(event);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与提交表单一样，也可以通过JavaScript来重置表单</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//重置表单 </span></span><br><span class="line">form.reset();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与调用<code>form.submit()</code>方法不同，调用<code>form.reset()</code>方法会像单击重置按钮一样触发<code>reset</code>事件。</p>
</blockquote>
<h3 id="表单字段"><a href="#表单字段" class="headerlink" title="表单字段"></a>表单字段</h3><p>每个表单都有<code>form.elements</code>属性，该属性是表单中所有表单元素（字段）的集合。这个<code>form.elements</code>集合是一个有序列表，其中包含着表单中的所有字段，</p>
<p>每个表单字段在<code>form.elements</code>集合中的顺序，与它们出现在标记中的顺序相同，可以按照位置和<code>name</code>特性来访问它们。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"form1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得表单中的第一个字段 </span></span><br><span class="line"><span class="keyword">var</span> field1 = form.elements[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得名为"textbox1"的字段 </span></span><br><span class="line"><span class="keyword">var</span> field2 = form.elements[<span class="string">"textbox1"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得表单中包含的字段的数量 </span></span><br><span class="line"><span class="keyword">var</span> fieldCount = form.elements.length;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果有多个表单控件都在使用一个<code>name</code>（如单选按钮），那么就会返回以该<code>name</code>命名的一个<code>NodeList</code>。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">id</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"red"</span>&gt;</span>Red<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"green"</span>&gt;</span>Green<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"blue"</span>&gt;</span>Blue<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在这个HTML表单中，有3个单选按钮，它们的<code>name</code>都是”color”，意味着这3个字段是一起的。在访问<code>elements[&quot;color&quot;]</code>时，就会返回一个<code>NodeList</code>，其中包含这3个元素；不过，如果访问<code>elements[0]</code>，则只会返回第一个元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colorFields = form.elements[<span class="string">"color"</span>];</span><br><span class="line">alert(colorFields.length); <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstColorField = colorFields[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> firstFormField = form.elements[<span class="number">0</span>];</span><br><span class="line">alert(firstColorField === firstFormField);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以通过访问表单的属性来访问元素，例如<code>form[0]</code>可以取得第一个表单字段，而<code>form[&quot;color&quot;]</code>则可以取得第一个命名字段。这些属性与通过<code>form.elements</code>集合访问到的元素是相同的。但是，我们应该尽可能使用<code>form.elements</code>，通过表单属性访问元素只是为了与旧浏览器向后兼容而保留的一种过渡方式。</p>
</blockquote>
<h4 id="共有的表单字段属性"><a href="#共有的表单字段属性" class="headerlink" title="共有的表单字段属性"></a>共有的表单字段属性</h4><p>除了<code>&lt;fieldset&gt;</code>元素之外，所有表单字段都拥有相同的一组属性。由于<code>&lt;input&gt;</code>类型可以表示多种表单字段，因此有些属性只适用于某些字段，但还有一些属性是所有字段所共有的。表单字段共有的属性如下:</p>
<ul>
<li><code>disabled</code>：布尔值，表示当前字段是否被禁用。</li>
<li><code>form</code>：指向当前字段所属表单的指针；只读。</li>
<li><code>name</code>：当前字段的名称。</li>
<li><code>readOnly</code>：布尔值，表示当前字段是否只读。</li>
<li><code>tabIndex</code>：表示当前字段的切换（tab）序号。</li>
<li><code>type</code>：当前字段的类型，如”checkbox”、”radio”，等等。</li>
<li><code>value</code>：当前字段将被提交给服务器的值。对文件字段来说，这个属性是只读的，包含着文件在计算机中的路径。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"><span class="keyword">var</span> field = form.elements[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改 value 属性 </span></span><br><span class="line">field.value = <span class="string">"Another value"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检查 form 属性的值 </span></span><br><span class="line">alert(field.form === form); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//把焦点设置到当前字段 </span></span><br><span class="line">field.focus();</span><br><span class="line"></span><br><span class="line"><span class="comment">//禁用当前字段 </span></span><br><span class="line">field.disabled = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改 type 属性（不推荐，但对&lt;input&gt;来说是可行的） </span></span><br><span class="line">field.type = <span class="string">"checkbox"</span>;</span><br></pre></td></tr></table></figure>
<p>能够动态修改表单字段属性，意味着我们可以在任何时候，以任何方式来动态操作表单。重复单击表单的提交按钮, 最常见的解决方案，就是在第一次单击后就禁用提交按钮。只要侦听<code>submit</code>事件，并在该事件发生时禁用提交按钮即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//避免多次提交表单 </span></span><br><span class="line">EventUtil.addHandler(form, <span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//取得提交按钮 </span></span><br><span class="line">  <span class="keyword">var</span> btn = target.elements[<span class="string">"submit-btn"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//禁用它 </span></span><br><span class="line">  btn.disabled = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上代码为表单的submit事件添加了一个事件处理程序。事件触发后，代码取得了提交按钮并将其disabled属性设置为true。注意，不能通过onclick事件处理程序来实现这个功能. 因为有的浏览器会在触发表单的submit事件之前触发click事件，而有的浏览器则相反。</p>
<p>因此，最好是通过submit事件来禁用提交按钮。不过，这种方式不适合表单中不包含提交按钮的情况；如前所述，只有在包含提交按钮的情况下，才有可能触发表单的submit事件。</p>
</blockquote>
<p>除了<code>&lt;fieldset&gt;</code>之外，所有表单字段都有<code>element.type</code>属性。对于<code>&lt;input&gt;</code>元素，这个值等于HTML特性<code>type</code>的值。对于其他元素，这个<code>type</code>属性的值如下表所列。</p>
<p><img src="https://i.loli.net/2017/12/30/5a46fd0916ad1.jpg" alt=""></p>
<blockquote>
<p><code>&lt;input&gt;</code>和<code>&lt;button&gt;</code>元素的<code>type</code>属性是可以动态修改的，而<code>&lt;select&gt;</code>元素的type属性则是只读的。</p>
</blockquote>
<h4 id="共有的表单字段方法"><a href="#共有的表单字段方法" class="headerlink" title="共有的表单字段方法"></a>共有的表单字段方法</h4><p>每个表单字段都有两个方法：<code>element.focus()</code>和<code>element.blur()</code></p>
<p>使用<code>element.focus()</code>方法，可以将用户的注意力吸引到页面中的某个部位。例如，在页面加载完毕后，将焦点转移到表单中的第一个字段。为此，可以侦听页面的load事件，并在该事件发生时在表单的第一个字段上调用<code>element.focus()</code>方法.</p>
<blockquote>
<p>要注意的是，如果第一个表单字段是一个<code>&lt;input&gt;</code>元素，且其type特性的值为”hidden”，那么以上代码会导致错误。另外，如果使用CSS的display和visibility属性隐藏了该字段，同样也会导致错误。</p>
</blockquote>
<p>HTML5为表单字段新增了一个<code>autofocus</code>属性。在支持这个属性的浏览器中，只要设置这个属性，不用JavaScript就能自动把焦点移动到相应字段。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为了保证前面的代码在设置autofocus的浏览器中正常运行，必须先检测是否设置了该属性，如果设置了，就不用再调用focus()了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">"load"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (element.autofocus !== <span class="literal">true</span>) &#123;</span><br><span class="line">    element.focus();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"JS focus"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为<code>autofocus</code>是一个布尔值属性，所以在支持的浏览器中它的值应该是true。（在不支持的浏览器中，它的值将是空字符串。<br>在默认情况下，只有表单字段可以获得焦点。对于其他元素而言，如果先将其<code>element.tabIndex</code>属性设置为-1，然后再调用focus()方法，也可以让这些元素获得焦点。</p>
</blockquote>
<h4 id="共有的表单字段事件"><a href="#共有的表单字段事件" class="headerlink" title="共有的表单字段事件"></a>共有的表单字段事件</h4><p>除了支持鼠标、键盘、更改和HTML事件之外，所有表单字段都支持下列3个事件。</p>
<ul>
<li><code>blur</code>：当前字段失去焦点时触发。</li>
<li><code>change</code>：对于<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>元素，在它们失去焦点且<code>value</code>值改变时触发；对于<code>&lt;select&gt;</code>元素，在其选项改变时触发。</li>
<li><code>focus</code>：当前字段获得焦点时触发。</li>
</ul>
<p><code>change</code>事件在不同表单控件中触发的次数会有所不同。对于<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>元素，当它们从获得焦点到失去焦点且<code>value</code>值改变时，才会触发<code>change</code>事件。对于<code>&lt;select&gt;</code>元素，只要用户选择了不同的选项，就会触发change事件；换句话说，<strong>不失去焦点也会触发<code>change</code>事件</strong>。</p>
<p>可以使用<code>focus</code>和<code>blur</code>事件来以某种方式改变用户界面，要么是向用户给出视觉提示，要么是向界面中添加额外的功能（例如，为文本框显示一个下拉选项菜单）。为确保无论文本框的值如何变化，验证规则始终如一，<code>onblur</code>和<code>onchange</code>事件处理程序中使用了相同的正则表达式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="number">0</span>];</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">"focus"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">  <span class="keyword">if</span> (target.style.backgroundColor != <span class="string">"red"</span>) &#123;</span><br><span class="line">    target.style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">"blur"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[^\d]/</span>.test(target.value)) &#123;</span><br><span class="line">    target.style.backgroundColor = <span class="string">"red"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    target.style.backgroundColor = <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">"change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[^\d]/</span>.test(target.value)) &#123;</span><br><span class="line">    target.style.backgroundColor = <span class="string">"red"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    target.style.backgroundColor = <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="文本框脚本-input-textarea"><a href="#文本框脚本-input-textarea" class="headerlink" title="文本框脚本 input,textarea"></a>文本框脚本 input,textarea</h2><p>两种方式来表现文本框：<code>&lt;input&gt;</code>，<code>&lt;textarea&gt;</code></p>
<p>必须将<code>&lt;input&gt;</code>元素的type特性设置为”text”。而通过设置<code>size</code>特性，可以指定文本框中能够显示的字符数。通过<code>value</code>特性，可以设置文本框的初始值，而<code>maxlength</code>特性则用于指定文本框可以接受的最大字符数。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">size</span>=<span class="string">"25"</span> <span class="attr">maxlength</span>=<span class="string">"50"</span> <span class="attr">value</span>=<span class="string">"initial value"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;textarea&gt;</code>要指定大小，可以使用<code>rows</code>和<code>cols</code>特性。其中，<code>rows</code>特性指定的是文本框的字符行数，而<code>cols</code>特性指定的是文本框的字符列数,与<code>&lt;input&gt;</code>元素不同，<code>&lt;textarea&gt;</code>的初始值必须要放在<code>&lt;textarea&gt;</code>和<code>&lt;/textarea&gt;</code>之间，如下面的例子所示。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">"25"</span> <span class="attr">cols</span>=<span class="string">"5"</span>&gt;</span>initial value<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>无论这两种文本框在标记中有什么区别，但它们都会将用户输入的内容保存在<code>value</code>属性中。可以通过这个属性读取和设置文本框的值，如下面的例子所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="string">"textbox1"</span>];</span><br><span class="line">alert(textbox.value);</span><br><span class="line">textbox.value = <span class="string">"Some new value"</span>;</span><br></pre></td></tr></table></figure>
<p>建议像上面这样使用 <code>value</code> 属性读取或设置文本框的值，不要使用 <code>element.setAttribute()</code>设置<code>&lt;input&gt;</code>元素的 <code>value</code> 特性，也不要去修改<code>&lt;textarea&gt;</code> 元素的文本节点。原因很简单：对 <code>value</code> 属性所作的修改，不一定会反映在 <code>DOM</code> 中</p>
<h3 id="选择脚本"><a href="#选择脚本" class="headerlink" title="选择脚本"></a>选择脚本</h3><p>两种文本框都支持<code>element.select()</code>方法，这个方法用于选择文本框中的所有文本。在调用select()方法时，大多数浏览器（Opera除外）都会将焦点设置到文本框中。</p>
<p>在文本框获得焦点时选择其所有文本，这是一种非常常见的做法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(textbox, <span class="string">"focus"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">  target.select();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="select事件"><a href="#select事件" class="headerlink" title="select事件"></a>select事件</h4><p>与<code>element.select()</code>方法对应的，是一个<code>select</code>事件。在选择了文本框中的文本时，就会触发<code>select</code>事件。在调用<code>element.select()</code>方法时也会触发<code>select</code>事件。</p>
<h4 id="取得选择的文本"><a href="#取得选择的文本" class="headerlink" title="取得选择的文本"></a>取得选择的文本</h4><p>HTML5添加两个属性：<code>element.selectionStart</code>和<code>element.selectionEnd</code>。这两个属性中保存的是基于0的数值，表示所选择文本的范围（即文本选区开头和结尾的偏移量）</p>
<p>IE8及更早的版本中有一个<code>document.selection</code>对象，其中保存着用户在整个文档范围内选择的文本信息；无法确定用户选择的是页面中哪个部位的文本。不过，在与<code>select</code>事件一起使用的时候，可以假定是用户选择了文本框中的文本，因为触发了<code>select</code>事件。</p>
<p>要取得选择的文本，首先必须创建一个范围<code>range</code>，然后再将文本从其中提取出来，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSelectedText</span>(<span class="params">textbox</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> textbox.selectionStart == <span class="string">"number"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> textbox.value.substring(textbox.selectionStart, textbox.selectionEnd);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.selection) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.selection.createRange().text;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="选择部分文本"><a href="#选择部分文本" class="headerlink" title="选择部分文本"></a>选择部分文本</h4><p>所有文本框都有一个<code>element.setSelectionRange(start,end)</code>方法。</p>
<p>要看到选择的文本，必须在调用<code>element.setSelectionRange()</code>之前或之后立即将焦点设置到文本框。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">textbox.value = <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//选择所有文本 </span></span><br><span class="line">textbox.setSelectionRange(<span class="number">0</span>, textbox.value.length); <span class="comment">//"Hello world"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//选择前 3 个字符 </span></span><br><span class="line">textbox.setSelectionRange(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">//"Hel"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//选择第 4 到第 6 个字符 </span></span><br><span class="line">textbox.setSelectionRange(<span class="number">4</span>, <span class="number">7</span>); <span class="comment">//"o w"</span></span><br></pre></td></tr></table></figure>
<p>关于IE8如何选择部分文本的js程序由于涉及IE8及之前版本的<code>range</code>内容,固不在重点范围,详情先查阅高程范围部分p340, 再查阅此部分p422</p>
<h3 id="过滤输入"><a href="#过滤输入" class="headerlink" title="过滤输入"></a>过滤输入</h3><h4 id="屏蔽字符"><a href="#屏蔽字符" class="headerlink" title="屏蔽字符"></a>屏蔽字符</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(textbox, <span class="string">"keypress"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  EventUtil.preventDefault(event);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>运行以上代码后，由于所有按键操作都将被屏蔽，结果会导致文本框变成只读的。如果只想屏蔽特定的字符，则需要检测<code>keypress</code>事件对应的字符编码，然后再决定如何响应。例如，需求是只允许用户输入数值。</p>
<blockquote>
<p>理论上只应该在用户按下字符键时才触发keypress事件，但有些浏览器也会对其他键触发此事件。这意味着，仅考虑到屏蔽不是数值的字符还不够，还要避免屏蔽这些极为常用和必要的键。所幸的是，要检测这些键并不困难。在Firefox中，所有由非字符键触发的keypress事件对应的字符编码为0，而在Safari3以前的版本中，对应的字符编码全部为8。为了让代码更通用，只要不屏蔽那些字符编码小于10的键即可。</p>
<p>还有一个问题需要处理：复制、粘贴及其他操作还要用到<code>Ctrl</code>键。在除IE之外的所有浏览器中，前面的代码也会屏蔽<code>Ctrl+C</code>、<code>Ctrl+V</code>，以及其他使用<code>Ctrl</code>的组合键。因此，最后还要添加一个检测条件，以确保用户没有按下<code>Ctrl</code>键，如下面的例子所示。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(textbox, <span class="string">"keypress"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">  <span class="keyword">var</span> charCode = EventUtil.getCharCode(event);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/\d/</span>.test(<span class="built_in">String</span>.fromCharCode(charCode)) &amp;&amp; charCode &gt; <span class="number">9</span> &amp;&amp; !event.ctrlKey) &#123;</span><br><span class="line">    EventUtil.preventDefault(event);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在这个例子的基础上加以修改和调整，就可以将同样的技术运用于放过和屏蔽任何输入文本框的字符。</p>
</blockquote>
<h4 id="操作剪贴板"><a href="#操作剪贴板" class="headerlink" title="操作剪贴板"></a>操作剪贴板</h4><p>HTML5把剪贴板事件纳入了规范。下列就是6个剪贴板事件。</p>
<ul>
<li><code>beforecopy</code>：在发生复制操作前触发。</li>
<li><code>copy</code>：在发生复制操作时触发。</li>
<li><code>beforecut</code>：在发生剪切操作前触发。</li>
<li><code>cut</code>：在发生剪切操作时触发。</li>
<li><code>beforepaste</code>：在发生粘贴操作前触发。</li>
<li><code>paste</code>：在发生粘贴操作时触发。</li>
</ul>
<blockquote>
<p>。在Safari、Chrome和Firefox中，beforecopy、beforecut和beforepaste事件只会在显示针对文本框的上下文菜单（预期将发生剪贴板事件）的情况下触发。但是，IE则会在触发copy、cut和paste事件之前先行触发这些事件。至于copy、cut和paste事件，只要是在上下文菜单中选择了相应选项，或者使用了相应的键盘组合键，所有浏览器都会触发它们。</p>
</blockquote>
<p>要访问剪贴板中的数据，可以使用<code>clipboardData</code>对象, 为了确保跨浏览器兼容性，最好只在发生剪贴板事件期间使用这个对象。</p>
<blockquote>
<p>在 IE 中，<code>clipboardData</code>对象是 <code>window</code> 对象的属性；而在 Firefox 4+、Safari 和 Chrome 中，这个对象是相应 event 对象的属性。</p>
</blockquote>
<p>这个<code>clipboardData</code>对象有三个方法：<code>clipboardData.getData(string)</code>、<code>clipboardData.setData(string,content)</code>和<code>clipboardData.clearData()</code>。<br><code>clipboardData.getData(string)</code>用于从剪贴板中取得数据，它接受一个参数<code>string</code>，即要取得的数据的格式。在IE中，有两种数据格式：<code>text</code>和<code>URL</code>。在Firefox、Safari和Chrome中，这个参数是一种<code>MIME类型</code>；不过，可以用<code>text</code>代表<code>text/plain</code>。</p>
<p><code>clipboardData.setData(string,content) return boolean</code>方法,第一个参数也是数据类型，第二个参数是要放在剪贴板中的文本。对于第一个参数，IE照样支持<code>text</code>和<code>URL</code>，而Safari和Chrome仍然只支持<code>MIME类型</code>。但是，与<code>clipboardData.getData()</code>方法不同的是，Safari和Chrome的<code>clipboardData.setData()</code>方法不能识别<code>text</code>类型。这两个浏览器在成功将文本放到剪贴板中后，都会返回true；否则，返回false。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">  <span class="comment">//省略的代码</span></span><br><span class="line">  getClipboardText: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> clipboardData = (event.clipboardData || <span class="built_in">window</span>.clipboardData);</span><br><span class="line">    <span class="keyword">return</span> clipboardData.getData(<span class="string">"text"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  setClipboardText: <span class="function"><span class="keyword">function</span> (<span class="params">event, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.clipboardData) &#123;</span><br><span class="line">      <span class="keyword">return</span> event.clipboardData.setData(<span class="string">"text/plain"</span>, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.clipboardData) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">window</span>.clipboardData.setData(<span class="string">"text"</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//省略的代码</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在需要确保粘贴到文本框中的文本中包含某些字符，或者符合某种格式要求时，能够访问剪贴板是非常有用的。例如，如果一个文本框只接受数值，那么就必须检测粘贴过来的值，以确保有效。在<code>paste</code>事件中，可以确定剪贴板中的值是否有效，如果无效，取消默认的行为。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(textbox, <span class="string">"paste"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> text = EventUtil.getClipboardText(event);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^\d*$/</span>.test(text)) &#123;</span><br><span class="line">    EventUtil.preventDefault(event);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="自动切换焦点"><a href="#自动切换焦点" class="headerlink" title="自动切换焦点"></a>自动切换焦点</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"tel1"</span> <span class="attr">id</span>=<span class="string">"txtTel1"</span> <span class="attr">maxlength</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"tel2"</span> <span class="attr">id</span>=<span class="string">"txtTel2"</span> <span class="attr">maxlength</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"tel3"</span> <span class="attr">id</span>=<span class="string">"txtTel3"</span> <span class="attr">maxlength</span>=<span class="string">"4"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">tabForward</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target.value.length == target.maxLength) &#123;</span><br><span class="line">      <span class="keyword">var</span> form = target.form;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = form.elements.length; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (form.elements[i] == target) &#123;</span><br><span class="line">          <span class="keyword">if</span> (form.elements[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            form.elements[i + <span class="number">1</span>].focus();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> textbox1 = <span class="built_in">document</span>.getElementById(<span class="string">"txtTel1"</span>);</span><br><span class="line">  <span class="keyword">var</span> textbox2 = <span class="built_in">document</span>.getElementById(<span class="string">"txtTel2"</span>);</span><br><span class="line">  <span class="keyword">var</span> textbox3 = <span class="built_in">document</span>.getElementById(<span class="string">"txtTel3"</span>);</span><br><span class="line"></span><br><span class="line">  EventUtil.addHandler(textbox1, <span class="string">"keyup"</span>, tabForward);</span><br><span class="line">  EventUtil.addHandler(textbox2, <span class="string">"keyup"</span>, tabForward);</span><br><span class="line">  EventUtil.addHandler(textbox3, <span class="string">"keyup"</span>, tabForward);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h3 id="HTML5约束验证API"><a href="#HTML5约束验证API" class="headerlink" title="HTML5约束验证API"></a>HTML5约束验证API</h3><blockquote>
<p>为了在将表单提交到服务器之前验证数据，HTML5新增了一些功能。有了这些功能，即便JavaScript被禁用或者由于种种原因未能加载，也可以确保基本的验证。换句话说，浏览器自己会根据标记中的规则执行验证，然后自己显示适当的错误消息（完全不用JavaScript插手）。当然，这个功能只有在支持HTML5这部分内容的浏览器中才有效(IE不支持)</p>
</blockquote>
<h4 id="required"><a href="#required" class="headerlink" title="required"></a>required</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">required</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过对应的<code>element.required</code>属性，可以检查某个表单字段是否为必填字段。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isUsernameRequired = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="string">"username"</span>].required;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用下面这行代码可以测试浏览器是否支持 required 属性。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isRequiredSupported = <span class="string">"required"</span> <span class="keyword">in</span> <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="其他输入类型"><a href="#其他输入类型" class="headerlink" title="其他输入类型"></a>其他输入类型</h4><p>HTML5为<code>&lt;input&gt;</code>元素的<code>type</code>属性又增加了几个值。这些新的类型不仅能反映数据类型的信息，而且还能提供一些默认的验证功能。<code>email</code>和<code>url</code>是两个得到支持最多的类型，各浏览器也都为它们增加了定制的验证机制。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span> =<span class="string">"email"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"url"</span> <span class="attr">name</span>=<span class="string">"homepage"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>要检测浏览器是否支持这些新类型，可以在JavaScript创建一个<code>&lt;input&gt;</code>元素，然后将<code>type</code>属性设置为<code>email</code>或<code>url</code>，最后再检测这个属性的值。不支持它们的旧版本浏览器会自动将未知的值设置为”text”，而支持的浏览器则会返回正确的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span><br><span class="line">input.type = <span class="string">"email"</span>;</span><br><span class="line"><span class="keyword">var</span> isEmailSupported = (input.type == <span class="string">"email"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="数值范围"><a href="#数值范围" class="headerlink" title="数值范围"></a>数值范围</h4><p>HTML5还给<code>&lt;input&gt;</code>标签的<code>type</code>还有几种取值: <code>number</code>、<code>range</code>、<code>datetime</code>、<code>datetime-local</code>、<code>date</code>、<code>month</code>、<code>week</code>，还有<code>time</code>。</p>
<blockquote>
<p>对所有这些数值类型的输入元素，可以指定<code>min</code>属性（最小的可能值）、<code>max</code>属性（最大的可能值）和<code>step</code>属性（从<code>min</code>到<code>max</code>的两个刻度间的差值）。例如，想让用户只能输入0到100的值，而且这个值必须是5的倍数，可以这样写代码：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">min</span>=<span class="string">"0"</span> <span class="attr">max</span>=<span class="string">"100"</span> <span class="attr">step</span>=<span class="string">"5"</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这些属性在JavaScript中都能通过对应的元素访问（或修改）。此外，还有两个方法：<code>element.stepUp()</code>和<code>element.stepDown()</code>，都接收一个可选的参数：要在当前值基础上加上或减去的数值。（默认是加或减1。）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input.stepUp(); <span class="comment">//加 1 </span></span><br><span class="line">input.stepUp(<span class="number">5</span>); <span class="comment">//加 5 </span></span><br><span class="line">input.stepDown(); <span class="comment">//减 1 </span></span><br><span class="line">input.stepDown(<span class="number">10</span>); <span class="comment">//减 10</span></span><br></pre></td></tr></table></figure>
<h4 id="输入模式"><a href="#输入模式" class="headerlink" title="输入模式"></a>输入模式</h4><p>HTML5为文本字段新增了<code>pattern</code>属性。这个属性的值是一个正则表达式，用于匹配文本框中的值。例如，如果只想允许在文本字段中输入数值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">pattern</span>=<span class="string">"\d+"</span> <span class="attr">name</span>=<span class="string">"count"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>模式的开头和末尾不用加^和$符号（假定已经有了）。</p>
<p>与其他输入类型相似，指定<code>pattern</code>也不能阻止用户输入无效的文本。这个模式应用给值，浏览器来判断值是有效，还是无效。在 JavaScript 中可以通过 <code>element.pattern</code> 属性访问模式。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pattern = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="string">"count"</span>].pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测浏览器是否支持pattern属性</span></span><br><span class="line"><span class="keyword">var</span> isPatternSupported = <span class="string">"pattern"</span> <span class="keyword">in</span> <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="检测有效性"><a href="#检测有效性" class="headerlink" title="检测有效性"></a>检测有效性</h4><ul>
<li><code>element(form).checkValidity() return boolean</code>方法可以检测表单中的某个字段是否有效。所有表单字段都有个方法，如果字段的值有效，这个方法返回true，否则返回false。字段的值是否有效的判断依据是本节前面介绍过的那些约束。</li>
</ul>
<p>要检测整个表单是否有效，可以在表单自身调用<code>form.checkValidity()</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证字段</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="number">0</span>].checkValidity()) &#123;</span><br><span class="line">  <span class="comment">//字段有效，继续</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//字段无效 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证表单</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.forms[<span class="number">0</span>].checkValidity()) &#123;</span><br><span class="line">  <span class="comment">//表单有效，继续 </span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//表单无效 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>element.validity</code>属性,是一个对象包含一系列属性，每个属性会返回一个布尔值</p>
<ul>
<li><code>customError</code>：如果设置了setCustomValidity()，则为true，否则返回false。</li>
<li><code>patternMismatch</code>：如果值与指定的pattern属性不匹配，返回true。</li>
<li><code>rangeOverflow</code>：如果值比max值大，返回true。</li>
<li><code>rangeUnderflow</code>：如果值比min值小，返回true。</li>
<li><code>stepMisMatch</code>：如果min和max之间的步长值不合理，返回true。</li>
<li><code>tooLong</code>：如果值的长度超过了maxlength属性指定的长度，返回true。有的浏览器（如Firefox4）会自动约束字符数量，因此这个值可能永远都返回false。</li>
<li><code>typeMismatch</code>：如果值不是”mail”或”url”要求的格式，返回true。</li>
<li><code>valid</code>：如果这里的其他属性都是false，返回true。checkValidity()也要求相同的值。</li>
<li><code>valueMissing</code>：如果标注为required的字段中没有值，返回true。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (input.validity &amp;&amp; !input.validity.valid) &#123;</span><br><span class="line">  <span class="keyword">if</span> (input.validity.valueMissing) &#123;</span><br><span class="line">    alert(<span class="string">"Please specify a value."</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (input.validity.typeMismatch) &#123;</span><br><span class="line">    alert(<span class="string">"Please enter an email address."</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(<span class="string">"Value is invalid."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="禁用验证"><a href="#禁用验证" class="headerlink" title="禁用验证"></a>禁用验证</h4><ul>
<li><code>novalidate</code>属性,可以告诉表单不进行验证</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"signup.php"</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--这里插入表单元素--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在JavaScript中使用noValidate属性可以取得或设置这个值，如果这个属性存在，值为true，如果不存在，值为false。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.forms[<span class="number">0</span>].noValidate = <span class="literal">true</span>; <span class="comment">//禁用验证</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>formnovalidate</code> 属性, 如果一个表单中有多个提交按钮，为了指定点击某个提交按钮不必验证表单，可以在相应的按钮上添加<code>formnovalidate</code>属性</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"foo.php"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--这里插入表单元素--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Regular Submit"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">formnovalidate</span> <span class="attr">name</span>=<span class="string">"btnNoValidate"</span> <span class="attr">value</span>=<span class="string">"Non-validating Submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 JavaScript 也可以设置这个属性</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//禁用验证 </span></span><br><span class="line"><span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="string">"btnNoValidate"</span>].formNoValidate = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<h2 id="选择框脚本"><a href="#选择框脚本" class="headerlink" title="选择框脚本"></a>选择框脚本</h2><p>选择框是通过<code>&lt;select&gt;</code>和<code>&lt;option&gt;</code>元素创建的。为了方便与这个控件交互，除了所有表单字段共有的属性和方法外，<code>HTMLSelectElement</code>类型还提供了下列属性和方法。</p>
<ul>
<li><code>add(newOption,relOption)</code>：向控件中插入新<code>&lt;option&gt;</code>元素，其位置在相关项（relOption）之前。</li>
<li><code>multiple</code>：布尔值，表示是否允许多项选择；等价于HTML中的<code>multiple</code>特性。</li>
<li><code>options</code>：控件中所有<code>&lt;option&gt;</code>元素的HTMLCollection。</li>
<li><code>remove(index)</code>：移除给定位置的选项。</li>
<li><code>selectedIndex</code>：基于0的选中项的索引，如果没有选中项，则值为-1。对于支持多选的控件，只保存选中项中第一项的索引。</li>
<li><code>size</code>：选择框中可见的行数；等价于HTML中的<code>size</code>特性。</li>
</ul>
<p>选择框的<code>element.type</code>属性不是”select-one”，就是”select-multiple”，这取决于HTML代码中有没有<code>multiple</code>特性。选择框的<code>element.value</code>属性由当前选中项决定</p>
<ul>
<li>如果没有选中的项，则选择框的<code>value</code>属性保存<code>空字符串</code>。</li>
<li>如果有一个选中项，而且该项的<code>value特性</code>已经在HTML中指定，则选择框的<code>value属性</code>等于选中项的<code>value特性</code>。即使value特性的值是空字符串，也同样遵循此条规则。</li>
<li>如果有一个选中项，但该项的<code>value特性</code>在HTML中未指定，则选择框的value属性等于该项的文本。</li>
<li>如果有多个选中项，则选择框的<code>value属性</code>将依据前两条规则取得第一个选中项的值</li>
</ul>
<p>每个<code>&lt;option&gt;</code>元素都有一个<code>HTMLOptionElement</code>对象表示。为便于访问数据，<code>HTMLOptionElement</code>对象添加了下列属性：</p>
<ul>
<li><code>index</code>：当前选项在options集合中的索引。</li>
<li><code>label</code>：当前选项的标签；等价于HTML中的label特性。</li>
<li><code>selected</code>：布尔值，表示当前选项是否被选中。将这个属性设置为true可以选中当前选项。</li>
<li><code>text</code>：选项的文本。</li>
<li><code>value</code>：选项的值（等价于HTML中的value特性）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectbox = <span class="built_in">document</span>.forms[<span class="number">0</span>].elements[<span class="string">"location"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//推荐 </span></span><br><span class="line"><span class="keyword">var</span> text = selectbox.options[<span class="number">0</span>].text; <span class="comment">//选项的文本</span></span><br><span class="line"><span class="keyword">var</span> value = selectbox.options[<span class="number">0</span>].value;  <span class="comment">//选项的值</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>选择框的<code>change</code>事件与其他表单字段的<code>change</code>事件触发的条件不一样。其他表单字段的<code>change</code>事件是在值被修改且焦点离开当前字段时触发，而选择框的<code>change</code>事件只要选中了选项就会触发。<br>在未指定<code>value</code>特性的情况下，IE8会返回空字符串，而IE9+、Safari、Firefox、Chrome和Opera则会返回与text特性相同的值。</p>
</blockquote>
<h3 id="选择选项"><a href="#选择选项" class="headerlink" title="选择选项"></a>选择选项</h3><p>对于只允许选择一项的选择框，访问选中项的最简单方式，就是使用选择框的 <code>element.selectedIndex</code> 属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectedOption = selectbox.options[selectbox.selectedIndex];</span><br></pre></td></tr></table></figure>
<p>另一种选择选项的方式，就是取得对某一项的引用，然后将其<code>element.selected</code>属性设置为true。例如，下面的代码会选中选择框中的第一项：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectbox.options[<span class="number">0</span>].selected=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与<code>element.selectedIndex</code>不同，在允许多选的选择框中设置选项的<code>element.selected</code>属性，不会取消对其他选中项的选择，因而可以动态选中任意多个项。但是，如果是在单选选择框中，修改某个选项的<code>element.selected</code>属性则会取消对其他选项的选择。需要注意的是，将<code>element.selected</code>属性设置为false对单选选择框没有影响。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSelectedOptions</span>(<span class="params">selectbox</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">  <span class="keyword">var</span> option = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = selectbox.options.length; i &lt; len; i++) &#123;</span><br><span class="line">    option = selectbox.options[i];</span><br><span class="line">    <span class="keyword">if</span> (option.selected) &#123;</span><br><span class="line">      result.push(option);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加选项"><a href="#添加选项" class="headerlink" title="添加选项"></a>添加选项</h3><p>可以使用JavaScript动态创建选项，并将它们添加到选择框中。第一种方式就是使用如下所示的DOM方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newOption = <span class="built_in">document</span>.createElement(<span class="string">"option"</span>);</span><br><span class="line">newOption.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">"Option text"</span>));</span><br><span class="line">newOption.setAttribute(<span class="string">"value"</span>, <span class="string">"Option value"</span>);</span><br><span class="line"></span><br><span class="line">selectbox.appendChild(newOption);</span><br></pre></td></tr></table></figure>
<p>第二种方式是使用<code>Option构造函数</code>来创建新选项，这个构造函数是DOM出现之前就有的，一直遗留到现在。<code>Option构造函数</code>接受两个参数：<code>文本（text）</code>和<code>值（value）</code>；第二个参数可选。虽然这个构造函数会创建一个<code>Object</code>的实例，但兼容DOM的浏览器会返回一个<code>&lt;option&gt;</code>元素。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newOption = <span class="keyword">new</span> Option(<span class="string">"Option text"</span>, <span class="string">"Option value"</span>);</span><br><span class="line">selectbox.appendChild(newOption); <span class="comment">//在 IE8 及之前版本中有问题</span></span><br></pre></td></tr></table></figure>
<p>使用选择框的<code>select.add()</code>方法。DOM规定这个方法接受两个参数：要添加的新选项和将位于新选项之后的选项。如果想在列表的最后添加一个选项，应该将第二个参数设置为null。在IE对<code>select.add()</code>方法的实现中，第二个参数是可选的，而且如果指定，该参数必须是新选项之后选项的索引。兼容DOM的浏览器要求必须指定第二个参数，因此要想编写跨浏览器的代码，就不能只传入一个参数。这时候，为第二个参数传入undefined，就可以在所有浏览器中都将新选项插入到列表最后了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newOption = <span class="keyword">new</span> Option(<span class="string">"Option text"</span>, <span class="string">"Option value"</span>);</span><br><span class="line">selectbox.add(newOption, <span class="literal">undefined</span>); <span class="comment">//最佳方案</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> 如果想将新选项添加到其他位置（不是最后一个），就应该使用标准的DOM技术和<code>select.insertBefore()</code>方法。</p>
</blockquote>
<h3 id="移除选项"><a href="#移除选项" class="headerlink" title="移除选项"></a>移除选项</h3><p>可以使用 DOM 的 <code>element.removeChild()</code>方法， 为其传入要移除的选项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectbox.removeChild(selectbox.options[<span class="number">0</span>]); <span class="comment">//移除第一个选项</span></span><br></pre></td></tr></table></figure>
<p>可以使用选择框的 <code>select.remove(index)</code>方法。这个方法接受一个参数，即要移除选项的索引</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectbox.remove(<span class="number">0</span>); <span class="comment">//移除第一个选项</span></span><br></pre></td></tr></table></figure>
<p>最后一种方式，就是将相应选项设置为 null。这种方式也是 DOM 出现之前浏览器的遗留机制。 例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectbox.options[<span class="number">0</span>] = <span class="literal">null</span>; <span class="comment">//移除第一个选项</span></span><br></pre></td></tr></table></figure>
<h3 id="移动和重排选项"><a href="#移动和重排选项" class="headerlink" title="移动和重排选项"></a>移动和重排选项</h3><ul>
<li>移动</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectbox1 = <span class="built_in">document</span>.getElementById(<span class="string">"selLocations1"</span>);</span><br><span class="line"><span class="keyword">var</span> selectbox2 = <span class="built_in">document</span>.getElementById(<span class="string">"selLocations2"</span>);</span><br><span class="line"></span><br><span class="line">selectbox2.appendChild(selectbox1.options[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<ul>
<li>重排</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> optionToMove = selectbox.options[<span class="number">1</span>];</span><br><span class="line">selectbox.insertBefore(optionToMove, selectbox.options[optionToMove.index - <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="表单序列化"><a href="#表单序列化" class="headerlink" title="表单序列化"></a>表单序列化</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">form</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> parts = [],</span><br><span class="line">    field = <span class="literal">null</span>,</span><br><span class="line">    i,</span><br><span class="line">    len,</span><br><span class="line">    j,</span><br><span class="line">    optLen,</span><br><span class="line">    option,</span><br><span class="line">    optValue;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>, len = form.elements.length; i &lt; len; i++) &#123;</span><br><span class="line">    field = form.elements[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (field.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"select-one"</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"select-multiple"</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (field.name.length) &#123;</span><br><span class="line">          <span class="keyword">for</span> (j = <span class="number">0</span>, optLen = field.options.length; j &lt; optLen; j++) &#123;</span><br><span class="line">            option = field.options[j];</span><br><span class="line">            <span class="keyword">if</span> (option.selected) &#123;</span><br><span class="line">              optValue = <span class="string">""</span>;</span><br><span class="line">              <span class="keyword">if</span> (option.hasAttribute) &#123;</span><br><span class="line">                optValue = (option.hasAttribute(<span class="string">"value"</span>) ? option.value : option.text);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                optValue = (option.attributes[<span class="string">"value"</span>].specified ? option.value : option.text);</span><br><span class="line">              &#125;</span><br><span class="line">              parts.push(<span class="built_in">encodeURIComponent</span>(field.name) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(optValue));</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="literal">undefined</span>: <span class="comment">//fieldset</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"file"</span>: <span class="comment">//file input</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"submit"</span>: <span class="comment">//submit button</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"reset"</span>: <span class="comment">//reset button</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"button"</span>: <span class="comment">//custom button</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"radio"</span>: <span class="comment">//radio button</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"checkbox"</span>: <span class="comment">//checkbox</span></span><br><span class="line">        <span class="keyword">if</span> (!field.checked) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* falls through */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">//don't include form fields without names</span></span><br><span class="line">        <span class="keyword">if</span> (field.name.length) &#123;</span><br><span class="line">          parts.push(<span class="built_in">encodeURIComponent</span>(field.name) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(field.value));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> parts.join(<span class="string">"&amp;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面这个serialize()函数首先定义了一个名为parts的数组，用于保存将要创建的字符串的各个部分。然后，通过for循环迭代每个表单字段，并将其保存在field变量中。在获得了一个字段的引用之后，使用switch语句检测其type属性。序列化过程中最麻烦的就是<code>&lt;select&gt;</code>元素，它可能是单选框也可能是多选框。为此，需要遍历控件中的每一个选项，并在相应选项被选中的情况下向数组中添加一个值。对于单选框，只可能有一个选中项，而多选框则可能有零或多个选中项。这里的代码适用于这两种选择框，至于可选项的数量则是由浏览器控制的。在找到一个选中项之后，需要确定使用什么值。如果不存在value特性，或者虽然存在该特性，但值为空字符串，都要使用选项的文本来代替。为检查这个特性，在DOM兼容的浏览器中需要使用hasAttribute()方法，而在IE中需要使用特性的specified属性。<br>如果表单中包含<code>&lt;fieldset&gt;</code>元素，则该元素会出现在元素集合中，但没有type属性。因此，如果type属性未定义，则不需要对其进行序列化。同样，对于各种按钮以及文件输入字段也是如此（文件输入字段在表单提交过程中包含文件的内容；但是，这个字段是无法模仿的，序列化时一般都要忽略）。对于单选按钮和复选框，要检查其checked属性是否被设置为false，如果是则退出switch语句。如果checked属性为true，则继续执行default语句，即将当前字段的名称和值进行编码，然后添加到parts数组中。函数的最后一步，就是使用join()格式化整个字符串，也就是用和号来分隔每一个表单字段。</p>
</blockquote>
<h2 id="富文本编辑"><a href="#富文本编辑" class="headerlink" title="富文本编辑"></a>富文本编辑</h2><blockquote>
<p>就是在页面中嵌入一个包含空HTML页面的<code>iframe</code>。通过设置<code>document.designMode</code>属性，这个空白的HTML页面可以被编辑，而编辑对象则是该页面<code>&lt;body&gt;</code>元素的HTML代码。<code>document.designMode属性</code>有两个可能的值：<code>off</code>（默认值）和<code>on</code>。在设置为<code>on</code>时，整个文档都会变得可以编辑（显示插入符号）</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Blank Page for Rich Text Editing<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"richedit"</span> <span class="attr">style</span>=<span class="string">"height:100px;width:100px;"</span> <span class="attr">src</span>=<span class="string">"blank.htm"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line">EventUtil.addHandler(window, "load", function () &#123;</span><br><span class="line">  frames["richedit"].document.designMode = "on";</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用element-contenteditable属性"><a href="#使用element-contenteditable属性" class="headerlink" title="使用element.contenteditable属性"></a>使用element.contenteditable属性</h3><blockquote>
<p>另一种编辑富文本内容的方式是使用名为<code>element.contenteditable</code>的特殊属性，这个属性也是由IE最早实现的。可以把<code>element.contenteditable</code>属性应用给页面中的任何元素，然后用户立即就可以编辑该元素。这种方法之所以受到欢迎,只要为元素设置 <code>element.contenteditable</code> 属性即可。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"editable"</span> <span class="attr">id</span>=<span class="string">"richedit"</span> <span class="attr">contenteditable</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，元素中包含的任何文本内容就都可以编辑了，就好像这个元素变成了<code>&lt;textarea&gt;</code>元素一样。通过在这个元素上设置<code>element.contenteditable</code>属性，也能打开或关闭编辑模式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"richedit"</span>);</span><br><span class="line">div.contentEditable = <span class="string">"true"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="document-execCommand-操作富文本"><a href="#document-execCommand-操作富文本" class="headerlink" title="document.execCommand() 操作富文本"></a>document.execCommand() 操作富文本</h3><p><code>document.execCommand()</code>方法, 这个方法可以对文档执行预定义的命令，而且可以应用大多数格式。是与富文本编辑器交互的主要方式. 可以为<code>document.execCommand(command,false,value/null)</code>方法传递3个参数：要执行的命令名称、表示浏览器是否应该为当前命令提供用户界面的一个布尔值, 执行命令必须的一个值（如果不需要值，则传递null）。为了确保跨浏览器的兼容性，第二个参数应该始终设置为false</p>
<p><img src="https://i.loli.net/2017/12/30/5a46fd0957c78.jpg" alt=""><br><img src="https://i.loli.net/2017/12/30/5a46fd092e3da.jpg" alt=""></p>
<blockquote>
<p>与剪贴板有关的命令在不同浏览器中的差异极大, 不过，即使不能通过<code>document.execCommand()</code>来执行这些命令，但却可以通过相应的快捷键来实现同样的操作。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//转换粗体文本 </span></span><br><span class="line">frames[<span class="string">"richedit"</span>].document.execCommand(<span class="string">"bold"</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//转换斜体文本 </span></span><br><span class="line">frames[<span class="string">"richedit"</span>].document.execCommand(<span class="string">"italic"</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建指向 www.wrox.com 的链接 </span></span><br><span class="line">frames[<span class="string">"richedit"</span>].document.execCommand(<span class="string">"createlink"</span>, <span class="literal">false</span>, <span class="string">"http://www.wrox.com"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//格式化为 1 级标题 </span></span><br><span class="line">frames[<span class="string">"richedit"</span>].document.execCommand(<span class="string">"formatblock"</span>, <span class="literal">false</span>, <span class="string">"&lt;h1&gt;"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样的方法也适用于页面中<code>element.contenteditable</code>属性为”true”的区块，只要把对框架的引用替换成当前窗口的<code>document</code>对象即可。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//转换粗体文本 </span></span><br><span class="line"><span class="built_in">document</span>.execCommand(<span class="string">"bold"</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//转换斜体文本 </span></span><br><span class="line"><span class="built_in">document</span>.execCommand(<span class="string">"italic"</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建指向 www.wrox.com 的链接 </span></span><br><span class="line"><span class="built_in">document</span>.execCommand(<span class="string">"createlink"</span>, <span class="literal">false</span>, <span class="string">"http://www.wrox.com"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//格式化为 1 级标题 </span></span><br><span class="line"><span class="built_in">document</span>.execCommand(<span class="string">"formatblock"</span>, <span class="literal">false</span>, <span class="string">"&lt;h1&gt;"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="document-queryCommandEnabled"><a href="#document-queryCommandEnabled" class="headerlink" title="document.queryCommandEnabled()"></a>document.queryCommandEnabled()</h4><p><code>document.queryCommandEnabled(command) return boolean</code>，可以用它来检测是否可以针对当前选择的文本，或者当前插入字符所在位置执行某个命令。这个方法接收一个参数，即要检测的命令。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = frames[<span class="string">"richedit"</span>].document.queryCommandEnabled(<span class="string">"bold"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="document-queryCommandState"><a href="#document-queryCommandState" class="headerlink" title="document.queryCommandState()"></a>document.queryCommandState()</h4><p><code>document.queryCommandState(command) return boolean</code>方法用于确定是否已将指定命令应用到了选择的文本。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isBold = frames[<span class="string">"richedit"</span>].document.queryCommandState(<span class="string">"bold"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="document-queryCommandValue"><a href="#document-queryCommandValue" class="headerlink" title="document.queryCommandValue()"></a>document.queryCommandValue()</h4><p><code>document.queryCommandValue()</code>，用于取得执行命令时传入的值（即前面例子中传给<code>document.execCommand()</code>的第三个参数）。例如，在对一段文本应用”fontsize”命令时如果传入了7，那么下面的代码就会返回”7”：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fontSize = frames[<span class="string">"richedit"</span>].document.queryCommandValue(<span class="string">"fontsize"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="富文本选区"><a href="#富文本选区" class="headerlink" title="富文本选区"></a>富文本选区</h3><p><code>document/frameElement.getSelection()</code>方法，可以确定实际选择的文本。HTML5 将 <code>getSelection()</code>方法纳入了标准, 这个方法是<code>window</code>对象和<code>document</code>对象的属性，调用它会返回一个表示当前选择文本的<code>Selection</code>对象, <code>Selection</code>对象有如下属性和方法:</p>
<blockquote>
<p>属性</p>
</blockquote>
<ul>
<li><code>selection.anchorNode</code>：选区起点所在的节点。</li>
<li><code>selection.anchorOffset</code>：在到达选区起点位置之前跳过的<code>selection.anchorNode</code>中的字符数量。</li>
<li><code>selection.focusNode</code>：选区终点所在的节点。</li>
<li><code>selection.focusOffset</code>：<code>selection.focusNode</code>中包含在选区之内的字符数量。</li>
<li><code>selection.isCollapsed</code>：布尔值，表示选区的起点和终点是否重合。</li>
<li><code>selection.rangeCount</code>：选区中包含的DOM范围的数量。</li>
</ul>
<blockquote>
<p>方法</p>
</blockquote>
<ul>
<li><code>selection.addRange(range)</code>：将指定的DOM范围添加到选区中。</li>
<li><code>selection.collapse(node,offset)</code>：将选区折叠到指定节点中的相应的文本偏移位置。</li>
<li><code>selection.collapseToEnd()</code>：将选区折叠到终点位置。</li>
<li><code>selection.collapseToStart()</code>：将选区折叠到起点位置。</li>
<li><code>selection.containsNode(node)</code>：确定指定的节点是否包含在选区中。</li>
<li><code>selection.deleteFromDocument()</code>：从文档中删除选区中的文本，与<code>document.execCommand(&quot;delete&quot;,false,null)</code>命令的结果相同。</li>
<li><code>selection.extend(node,offset)</code>：通过将<code>selection.focusNode</code>和<code>selection.focusOffset</code>移动到指定的值来扩展选区。</li>
<li><code>selection.getRangeAt(index)</code>：返回索引对应的选区中的DOM范围。</li>
<li><code>selection.removeAllRanges()</code>：从选区中移除所有DOM范围。实际上，这样会移除选区，因为选区中至少要有一个范围。</li>
<li><code>selection.reomveRange(range)</code>：从选区中移除指定的DOM范围。</li>
<li><code>selection.selectAllChildren(node)</code>：清除选区并选择指定节点的所有子节点。</li>
<li><code>selection.toString()</code>：返回选区所包含的文本内容。</li>
</ul>
<p><code>Selection</code>对象的这些方法都极为实用，它们利用了（第12章讨论过的）DOM范围来管理选区。由于可以直接操作选择文本的DOM表现，因此访问DOM范围与使用<code>document.execCommand(command,false,content/null)</code>相比，能够对富文本编辑器进行更加细化的控制</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selection = frames[<span class="string">"richedit"</span>].getSelection();</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得选择的文本 </span></span><br><span class="line"><span class="keyword">var</span> selectedText = selection.toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得代表选区的范围 </span></span><br><span class="line"><span class="keyword">var</span> range = selection.getRangeAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//突出显示选择的文本 </span></span><br><span class="line"><span class="keyword">var</span> span = frames[<span class="string">"richedit"</span>].document.createElement(<span class="string">"span"</span>);</span><br><span class="line">span.style.backgroundColor = <span class="string">"yellow"</span>;</span><br><span class="line">range.surroundContents(span);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>IE8 及 更早版本不支持DOM范围, 但可以通过它支持的<code>selection</code>对象操纵选择的文本, 详情先查阅高程p340,IE范围部分, 再查阅P442页关于IE富文本选区部分</p>
</blockquote>
<h3 id="表单与富文本"><a href="#表单与富文本" class="headerlink" title="表单与富文本"></a>表单与富文本</h3><p>由于富文本编辑是使用<code>iframe</code>而非表单控件实现的，因此从技术上说，富文本编辑器并不属于表单。换句话说，富文本编辑器中的HTML不会被自动提交给服务器，而需要我们手工来提取并提交HTML。为此，通常可以添加一个隐藏的表单字段，让它的值等于从iframe中提取出的HTML。具体来说，就是在提交表单之前，从iframe中提取出HTML，并将其插入到隐藏的字段中。下面就是通过表单的onsubmit事件处理程序实现上述操作的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(form, <span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line"></span><br><span class="line">  target.elements[<span class="string">"comments"</span>].value = frames[<span class="string">"richedit"</span>].document.body.innerHTML;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于使用 <code>contenteditable</code> 属性的元素，也可以执行类似操作。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(form, <span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event = EventUtil.getEvent(event);</span><br><span class="line">  <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line"></span><br><span class="line">  target.elements[<span class="string">"comments"</span>].value = <span class="built_in">document</span>.getElementById(<span class="string">"richedit"</span>).innerHTML;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/12/28/高程vol8-事件/" class="next">上一篇</a><a href="/2017/12/31/高程10-h5-error/" class="prev">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://yoursite.com">choteewang@qq.com</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>